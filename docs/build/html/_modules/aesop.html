<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>aesop &mdash; AESOP 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="AESOP 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for aesop</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Summary</span>

<span class="sd">Attributes</span>
<span class="sd">----------</span>
<span class="sd">AA_dict : dict</span>
<span class="sd">    Variable used to convert between 1 letter and 3 letter amino acid IDs</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">os</span>
<span class="c1"># import sys as sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="kn">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">timeit</span> <span class="kn">as</span> <span class="nn">ti</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="kn">as</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">prody</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.spatial</span> <span class="kn">as</span> <span class="nn">spatial</span>
<span class="c1"># import scipy.interpolate as interp</span>
<span class="kn">import</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="kn">as</span> <span class="nn">cluster</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="n">environ</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">selection</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cpu_count</span> <span class="c1">#, freeze_support</span>
<span class="kn">import</span> <span class="nn">gridData</span> <span class="kn">as</span> <span class="nn">gd</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="kn">as</span> <span class="nn">it</span>
<span class="c1"># import plotly.plotly as py</span>
<span class="c1"># import plotly.graph_objs as go</span>
<span class="c1"># from plotly.offline import download_plotlyjs, init_notebook_mode, iplot</span>
<span class="c1"># from plotly.tools import FigureFactory as FF</span>

<span class="c1"># Print Licencse on startup</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">AESOP: Analysis of Electrostatic Structure of Proteins</span>

<span class="s2">Reed E. S. Harrison, Rohith R. Mohan, Dimitios Morikis</span>
<span class="s2">University of California, Riverside; Department of Bioengineering</span>

<span class="s2">Correspondence should be directed to Prof. Dimitrios Morikis at dmorikis@ucr.edu  </span>

<span class="s2">Copyright (C) 2016  Reed E. S. Harrison, Rohith R. Mohan, Dimitios Morikis</span>

<span class="s2">This program is free software: you can redistribute it and/or modify</span>
<span class="s2">it under the terms of the GNU General Public License as published by</span>
<span class="s2">the Free Software Foundation, either version 3 of the License, or</span>
<span class="s2">(at your option) any later version.</span>

<span class="s2">This program is distributed in the hope that it will be useful,</span>
<span class="s2">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="s2">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="s2">GNU General Public License for more details.</span>

<span class="s2">You should have received a copy of the GNU General Public License</span>
<span class="s2">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    


<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Container for performing an Alanine Scan with AESOP</span>
<span class="c1">#   pdb     -   PDB file for performing Alascan. Must contain all chain selections with standard aminoacid nomenclature</span>
<span class="c1">#   selstr  -   List of selection strings for performing mutations</span>
<span class="c1">#   ion     -   Ionic strength</span>
<span class="c1">#   pdie    -   Protein dielectric constant   </span>
<span class="c1">#   sdie    -   Solvent dielectric constant</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="Alascan"><a class="viewcode-back" href="../aesop.html#aesop.Alascan">[docs]</a><span class="k">class</span> <span class="nc">Alascan</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Summary of internal varialbles in the Alascan class. All parameters are set in the Alascan.__init__(...) and the analysis is run with Alascan.run().</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    apbs : str</span>
<span class="sd">        Full path to APBS executable. Must be compatible with OS.</span>
<span class="sd">    apbs_results : str</span>
<span class="sd">        Full path to output from APBS</span>
<span class="sd">    cfac : float</span>
<span class="sd">        Scaling factor for grid dimensions. We suggest to leave this unchanged.</span>
<span class="sd">    coulomb : str</span>
<span class="sd">        Full path to coulomb executable from APBS package. Must be compatible with OS.</span>
<span class="sd">    coulomb_results : str</span>
<span class="sd">        Full path to folder containing results from coulomb.</span>
<span class="sd">    dime : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    dx : bool</span>
<span class="sd">        Variable that specifies if potential files should be written to disk. Default is False.</span>
<span class="sd">    dx_files : list</span>
<span class="sd">        If written to disk, list of potential files written to disk. The folder containing these files is given by Alascan.apbs_results.</span>
<span class="sd">    E_ref : ndarray</span>
<span class="sd">        Description</span>
<span class="sd">    E_solv : ndarray</span>
<span class="sd">        Description</span>
<span class="sd">    ff : str</span>
<span class="sd">        Force-field to use for PDB2PQR</span>
<span class="sd">    file_pdb_template : TYPE</span>
<span class="sd">        Description</span>
<span class="sd">    gcent : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    Gcoul : ndarray</span>
<span class="sd">        Coulombic free energies, corresponding to Alascan.mutid.</span>
<span class="sd">    glen : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    Gref : ndarray</span>
<span class="sd">        Reference-state free energies, corresponding to Alascan.mutid.</span>
<span class="sd">    grid : numeric</span>
<span class="sd">        Distance spacing of grid points. If the grid dimensions are not divisible by three, resolution will be increased (smaller grid spacing) until grid dimensions are divisible by three.</span>
<span class="sd">    Gsolv : ndarray</span>
<span class="sd">        Solvated-state free energies, corresponding to Alascan.mutid.</span>
<span class="sd">    ion : numeric</span>
<span class="sd">        Ionic strength to be used in the solvated-state APBS calculations.</span>
<span class="sd">    jobdir : str</span>
<span class="sd">        [Optional] Path to folder containing results. If not specified, a directory will be generated.</span>
<span class="sd">    jobname : str</span>
<span class="sd">        [Optional] Name for current job, will be used to create the jobdir.</span>
<span class="sd">    list_chids : list</span>
<span class="sd">        Chain ID where mutation was made. Corresponds to Alascan.mutid.</span>
<span class="sd">    list_resnames : list</span>
<span class="sd">        Residue names where mutation was made. Corresponds to Alascan.mutid.</span>
<span class="sd">    list_resnums : list</span>
<span class="sd">        Residue numbers where mutation was made. Corresponds to Alascan.mutic.</span>
<span class="sd">    logs_apbs_dir : str</span>
<span class="sd">        Folder in jobdir containing output from APBS (logs, input files, dx files)</span>
<span class="sd">    mask_by_sel : ndarray</span>
<span class="sd">        Matrix containing selection masks. The first column corresponds to the selection string for the parent and each column thereafter corresponds to an element of the selection string (selstr) in the same order.</span>
<span class="sd">    mutid : list</span>
<span class="sd">        List of mutant IDs. The first element corresponds to the parent. Subsequent elements correspond to each element of the selection string list (selstr). Please use Alascan.getMutids() to get vectorized version.</span>
<span class="sd">    pdb : str</span>
<span class="sd">        Path to PDB file with atomic coordinates. Must follow formatting conventions of the Protein Databank.</span>
<span class="sd">    pdb2pqr : str</span>
<span class="sd">        Full path to PDB2PQR executable.</span>
<span class="sd">    pdb_complex_dir : str</span>
<span class="sd">        Folder name in the job directory that contains the PDB file(s) of the complex structures.</span>
<span class="sd">    pdie : numeric</span>
<span class="sd">        Protein dielectric constant to be used in APBS.</span>
<span class="sd">    pqr_complex_dir : str</span>
<span class="sd">        Folder name in the job directory containing PQR files for each protein complex.</span>
<span class="sd">    pqr_sel_dir : list</span>
<span class="sd">        List of folder names in the job directory that contain PQR files for selection strings (selstr). Each element of pqr_sel_dir corresponds to the same element of selstr.</span>
<span class="sd">    region : list</span>
<span class="sd">        List of additional selection strings specifying the zone where mutations should occur. Generally unused, unless a region of interest is involved. Each element of region should correspond to the same element of selstr. That is, each region selection string will futher narrow down the initial selection string.</span>
<span class="sd">    sdie : numeric</span>
<span class="sd">        Solvent dielectric constant to be used in APBS.</span>
<span class="sd">    selstr : list</span>
<span class="sd">        List of selection strings. Typically each selection string will correspond to a chain in a protein complex. We advise users to specify two or more selection strings. (Ex: [&#39;chain A&#39;, &#39;chain B&#39;])</span>
<span class="sd">    </span>
<span class="sd">    Deleted Attributes</span>
<span class="sd">    ------------------</span>
<span class="sd">    dirs : int</span>
<span class="sd">        Description</span>
<span class="sd">    prefix : TYPE</span>
<span class="sd">        Description</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">pdb2pqr_exe</span><span class="p">,</span> <span class="n">apbs_exe</span><span class="p">,</span> <span class="n">coulomb_exe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selstr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;protein&#39;</span><span class="p">],</span> <span class="n">jobname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">grid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="mf">0.150</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="mf">78.54</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;parse&#39;</span><span class="p">,</span> <span class="n">cfac</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Constructor for the Alascan class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pdb : str</span>
<span class="sd">            The pdb file for which a computational alanine scan will be performed.</span>
<span class="sd">        pdb2pqr_exe : str</span>
<span class="sd">            Path to executable for PDB2PQR.</span>
<span class="sd">        apbs_exe : str</span>
<span class="sd">            Path to executable for APBS</span>
<span class="sd">        coulomb_exe : str, optional</span>
<span class="sd">            Path to executable for Coulomb from the APBS toolbox.</span>
<span class="sd">        selstr : list, optional</span>
<span class="sd">            List of selection strings. Typically each selection string will correspond to a chain in a protein complex. We advise users to specify two or more selection strings. The default selection will only investigate solvation free energies as there will be no binding event. (Ex: [&#39;chain A&#39;, &#39;chain B&#39;])</span>
<span class="sd">        jobname : str, optional</span>
<span class="sd">            A string representing the full path to the directory where results will be stored.</span>
<span class="sd">        region : str, optional</span>
<span class="sd">            If provided, region should be a selection string that specifies where mutations should be made. This must be the same length as selstr. Elements of selstr and region must correspond.</span>
<span class="sd">        grid : int, optional</span>
<span class="sd">            Desired grid spacing to be used in APBS. Depending on the PDB file, actual grid spacing may be a finer resolution. Defaults to 1 angstrom.</span>
<span class="sd">        ion : float, optional</span>
<span class="sd">            Ionic strength (M) to be used in APBS.</span>
<span class="sd">        pdie : float, optional</span>
<span class="sd">            Protein dielectric constant to be used in APBS.</span>
<span class="sd">        sdie : float, optional</span>
<span class="sd">            Solvent dielectric constant to be used in APBS&gt;</span>
<span class="sd">        ff : str, optional</span>
<span class="sd">            Force field to assign charges to individual atoms. We recommend using PARSE for this analysis, the default value.</span>
<span class="sd">        cfac : float, optional</span>
<span class="sd">            Scaling factor for grid dimension. This generally should not be changed without a reason.</span>
<span class="sd">        dx : bool, optional</span>
<span class="sd">            Boolean flag stating if potential files should be written to disk (True) or not (False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb2pqr</span> <span class="o">=</span> <span class="n">pdb2pqr_exe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span> <span class="o">=</span> <span class="n">apbs_exe</span>
        <span class="k">if</span> <span class="n">coulomb_exe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">apbs_exe</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="n">coulomb_exe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span> <span class="o">=</span> <span class="n">selstr</span>
        <span class="k">if</span> <span class="n">region</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">selstr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ion</span> <span class="o">=</span> <span class="n">ion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span> <span class="o">=</span> <span class="n">pdie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sdie</span> <span class="o">=</span> <span class="n">sdie</span>
        <span class="k">if</span> <span class="n">jobname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%4d%02d%02d</span><span class="s1">_</span><span class="si">%02d%02d%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobname</span> <span class="o">=</span> <span class="n">jobname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span> <span class="o">=</span> <span class="n">jobname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_solv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span> <span class="o">=</span> <span class="n">cfac</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">genDirs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genMutid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_grid</span><span class="p">()</span>

    <span class="c1"># def getPDB(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Summary</span>
        
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     string</span>
    <span class="c1">#         Description</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return self.pdb</span>

    <span class="c1"># def getSel(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Summary</span>
        
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     TYPE</span>
    <span class="c1">#         Description</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return self.selstr</span>

    <span class="c1"># def getDirs(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Summary</span>
        
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     TYPE</span>
    <span class="c1">#         Description</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return self.dirs</span>

    <span class="c1"># def getPrefix(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Summary</span>
        
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     TYPE</span>
    <span class="c1">#         Description</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return self.prefix</span>

<div class="viewcode-block" id="Alascan.getMutids"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.getMutids">[docs]</a>    <span class="k">def</span> <span class="nf">getMutids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Returns vectorized format of mutids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span></div>

    <span class="c1"># def getDX(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Summary</span>
        
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     TYPE</span>
    <span class="c1">#         Description</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return self.dx_files</span>

<div class="viewcode-block" id="Alascan.genDirs"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.genDirs">[docs]</a>    <span class="k">def</span> <span class="nf">genDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        This subroutine will generate all directories needed to contain structural files, logs, etc. In the future we may implement a method to remove such files when outputs are more standardized.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            No output, operates on the class and generates folders in the job directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create necessary directories for PDB files</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="s1">&#39;complex_pdb&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="n">pdb_complex_dir</span>

        <span class="c1"># Create necessary directories for PQR files</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="s1">&#39;complex_pqr&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">))</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selstr</span><span class="p">)):</span>
            <span class="n">pqr_sel_dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">_pqr&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">_pqr&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">_pqr&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="n">pqr_complex_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="n">pqr_sel_dir</span>

        <span class="c1"># Create necessary directories for APBS files</span>
        <span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="s1">&#39;apbs_logs&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="s1">&#39;apbs_logs&#39;</span></div>

<div class="viewcode-block" id="Alascan.genMutid"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.genMutid">[docs]</a>    <span class="k">def</span> <span class="nf">genMutid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        This subroutine reads the input PDB, selects the structure where mutations will occur, and saves all mutant IDs in the class. If region is specified in the constructor, then the constraint will be applied here.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Operates on the class to generate a list of mutant IDs for each selection string. The following class variables will be generated (see class description):</span>
<span class="sd">            	- mutid</span>
<span class="sd">            	- list_chids</span>
<span class="sd">            	- list_resnums</span>
<span class="sd">            	- list_resnames</span>
<span class="sd">            	- mask_by_sel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>

        <span class="n">parent_file_prefix</span> <span class="o">=</span> <span class="s1">&#39;wt&#39;</span>
        <span class="n">parent_pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="p">)</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">list_chids</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">list_resnums</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">list_resnames</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_file_prefix</span><span class="p">]</span>
        <span class="n">list_chids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">list_resnums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="n">list_resnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="n">reg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">selstr</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
            <span class="c1"># print &#39; and &#39;.join([sel, reg, &#39;charged&#39;, &#39;calpha&#39;])</span>
            <span class="n">combined_selection</span> <span class="o">=</span> <span class="n">parent_pdb</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sel</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="s1">&#39;charged&#39;</span><span class="p">,</span> <span class="s1">&#39;calpha&#39;</span><span class="p">]))</span>
            <span class="c1"># if sel is not reg:</span>
            <span class="c1">#     combined_selection = parent_pdb.select(&#39;&#39;.join([&#39;(&#39;, &#39;) and (&#39;.join((sel, reg, &#39;charged&#39;, &#39;calpha&#39;)), &#39;)&#39;]))</span>
            <span class="c1"># elif sel is reg:</span>
            <span class="c1">#     combined_selection = parent_pdb.select(&#39;&#39;.join([&#39;(&#39;, &#39;) and (&#39;.join((sel, &#39;charged&#39;, &#39;calpha&#39;)), &#39;)&#39;]))</span>
            <span class="n">list_chids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_selection</span><span class="o">.</span><span class="n">getChids</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">list_resnums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_selection</span><span class="o">.</span><span class="n">getResnums</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">list_resnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_selection</span><span class="o">.</span><span class="n">getResnames</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">code</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">AA_dict</span><span class="p">[</span><span class="n">res_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">res_no</span> <span class="o">+</span> <span class="s1">&#39;A&#39;</span> <span class="k">for</span> <span class="n">ch_id</span><span class="p">,</span> <span class="n">res_no</span><span class="p">,</span> <span class="n">res_id</span> <span class="ow">in</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="n">list_chids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">list_resnums</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">list_resnames</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="n">list_mutids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>

        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_mut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_mutids</span><span class="p">])</span>
        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mut</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">counter</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="o">=</span> <span class="n">list_mutids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_chids</span> <span class="o">=</span> <span class="n">list_chids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_resnums</span> <span class="o">=</span> <span class="n">list_resnums</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_resnames</span> <span class="o">=</span> <span class="n">list_resnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">mask_by_sel</span></div>

<div class="viewcode-block" id="Alascan.genParent"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.genParent">[docs]</a>    <span class="k">def</span> <span class="nf">genParent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Reads PDB file specified in the constructor; applies and combines results from the selection strings; and saves the final template structure in the job directory.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Template pdb written in job directory and location saved in Alascan.file_pdb_template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span>

        <span class="n">parent_file_prefix</span> <span class="o">=</span> <span class="s1">&#39;wt&#39;</span>
        <span class="n">parent_pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="p">)</span>

        <span class="c1"># list_mutids = [item for sublist in self.mutid for item in sublist]</span>
        <span class="c1"># list_chids = [item for sublist in self.list_chids for item in sublist]</span>
        <span class="c1"># list_resnums = [item for sublist in self.list_resnums for item in sublist]</span>

        <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">,</span> <span class="n">parent_file_prefix</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">parent_pdb</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;((&#39;</span> <span class="o">+</span> <span class="s1">&#39;) or (&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;))&#39;</span><span class="p">)</span>
        <span class="c1"># print &#39;((&#39;+&#39;) or (&#39;.join(selstr)+&#39;))&#39;</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_pdb_template</span> <span class="o">=</span> <span class="n">infile</span></div>

<div class="viewcode-block" id="Alascan.find_grid"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.find_grid">[docs]</a>    <span class="k">def</span> <span class="nf">find_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculate grid dimensions for APBS (dime, glen, gcent)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Sets class attributes dime, glen, and gcent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_pdb_template</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
        <span class="n">cfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span>

        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Find bounding box</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
        <span class="n">max_xyz</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">min_xyz</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Determine mesh dimensions according to Ron&#39;s AESOP protocol in the R source file</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_xyz</span> <span class="o">-</span> <span class="n">min_xyz</span><span class="p">)</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">fg</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">cfac</span><span class="p">)</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">glen</span><span class="p">,</span> <span class="n">fg</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dime_list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># list of possible dime values</span>
        <span class="n">dime_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">glen</span> <span class="o">/</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">grid</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># index of dime to use from list, subtract one to be consistent with python indexing!</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])]))</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">((</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iy</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iz</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dime</span> <span class="o">=</span> <span class="n">dime</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glen</span> <span class="o">=</span> <span class="n">glen</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">calcCenter</span><span class="p">(</span><span class="n">pdb</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>

<div class="viewcode-block" id="Alascan.set_grid"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.set_grid">[docs]</a>    <span class="k">def</span> <span class="nf">set_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dime</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        In the case that the user wishes to manually specify grid dimension, this may be accomplished with the set_grid method. Typically, this is used when grid space parameters must be consistent for many analyses. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/ for description of parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dime : list</span>
<span class="sd">            List of three integers.</span>
<span class="sd">        glen : list</span>
<span class="sd">            List of three integers.</span>
<span class="sd">        gcent : list</span>
<span class="sd">            List of three integers.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dime</span> <span class="o">=</span> <span class="n">dime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glen</span> <span class="o">=</span> <span class="n">glen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span> <span class="o">=</span> <span class="n">gcent</span></div>

    <span class="c1"># def genPDB(self):</span>
    <span class="c1">#     selstr = self.selstr</span>
    <span class="c1">#     region = self.region</span>
    <span class="c1">#     jobdir = self.jobdir</span>
    <span class="c1">#     pdb_complex_dir = self.pdb_complex_dir</span>
    <span class="c1">#</span>
    <span class="c1">#     parent_file_prefix = &#39;wt&#39;</span>
    <span class="c1">#     parent_pdb = pd.parsePDB(self.pdb)</span>
    <span class="c1">#</span>
    <span class="c1">#     list_mutids = [item for sublist in self.mutid for item in sublist]</span>
    <span class="c1">#     list_chids = [item for sublist in self.list_chids for item in sublist]</span>
    <span class="c1">#     list_resnums = [item for sublist in self.list_resnums for item in sublist]</span>
    <span class="c1">#</span>
    <span class="c1">#     infile = os.path.join(jobdir, pdb_complex_dir, parent_file_prefix + &#39;.pdb&#39;)</span>
    <span class="c1">#     system = parent_pdb.select(&#39;((&#39; + &#39;) or (&#39;.join(selstr) + &#39;))&#39;)</span>
    <span class="c1">#     # print &#39;((&#39;+&#39;) or (&#39;.join(selstr)+&#39;))&#39;</span>
    <span class="c1">#     pd.writePDB(infile, system)</span>
    <span class="c1">#</span>
    <span class="c1">#     for mutid, chain, resnum in zip(list_mutids[1:], list_chids[1:], list_resnums[1:]):</span>
    <span class="c1">#         outpath = os.path.join(jobdir, pdb_complex_dir, mutid)</span>
    <span class="c1">#         print &#39;\n%s:\tgenerating PDB for mutant: %s&#39; % (self.jobname, mutid)</span>
    <span class="c1">#         mutatePDB(pdb=infile, mutid=outpath, resnum=resnum, chain=chain, resid=&#39;ALA&#39;)</span>

<div class="viewcode-block" id="Alascan.genTruncatedPQR"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.genTruncatedPQR">[docs]</a>    <span class="k">def</span> <span class="nf">genTruncatedPQR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Generate a structure for each mutant ID by truncating the side chain to form alanine.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Write library of mutant structures to disk for subsequent analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">path_pdb2pqr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb2pqr</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">list_chids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_chids</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">list_resnums</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_resnums</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="c1"># Calculate PQR for parent</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">,</span> <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">,</span> <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">generating PQR for parent: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">execPDB2PQR</span><span class="p">(</span><span class="n">path_pdb2pqr</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="n">ff</span><span class="p">)</span>
        <span class="n">complex_pqr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePQR</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sel</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selstr</span><span class="p">,</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
            <span class="n">selfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
            <span class="n">pqr</span> <span class="o">=</span> <span class="n">complex_pqr</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">writePQR</span><span class="p">(</span><span class="n">selfile</span><span class="p">,</span> <span class="n">pqr</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mutid</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">resnum</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">list_chids</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">list_resnums</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">generating PQR for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="c1"># print &#39;mutid %s, chain %s, resnum %d&#39;%(mutid, chain, resnum)</span>
            <span class="c1"># print outpath+&#39;.pqr&#39;</span>
            <span class="n">mutatePQR</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">mutid</span><span class="o">=</span><span class="n">outpath</span><span class="p">,</span> <span class="n">resnum</span><span class="o">=</span><span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">)</span>
            <span class="n">complex_pqr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePQR</span><span class="p">(</span><span class="n">outpath</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sel</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selstr</span><span class="p">,</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">selfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="c1"># print selfile</span>
                <span class="n">pqr</span> <span class="o">=</span> <span class="n">complex_pqr</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">writePQR</span><span class="p">(</span><span class="n">selfile</span><span class="p">,</span> <span class="n">pqr</span><span class="p">)</span></div>

    <span class="c1"># def genPQR(self):</span>
    <span class="c1">#     &quot;&quot;&quot;Summary</span>
        
    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     TYPE</span>
    <span class="c1">#         Description</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     selstr = self.selstr</span>
    <span class="c1">#     jobdir = self.jobdir</span>
    <span class="c1">#     pdb_complex_dir = self.pdb_complex_dir</span>
    <span class="c1">#     pqr_complex_dir = self.pqr_complex_dir</span>
    <span class="c1">#     pqr_sel_dir = self.pqr_sel_dir</span>
    <span class="c1">#     path_pdb2pqr = self.pdb2pqr</span>
    <span class="c1">#     ff = self.ff</span>

    <span class="c1">#     list_mutids = [item for sublist in self.mutid for item in sublist]</span>

    <span class="c1">#     for mutid in list_mutids:</span>
    <span class="c1">#         print &#39;\n%s:\tgenerating PQR for mutant: %s&#39; % (self.jobname, mutid)</span>
    <span class="c1">#         infile = os.path.join(jobdir, pdb_complex_dir, mutid + &#39;.pdb&#39;)</span>
    <span class="c1">#         outfile = os.path.join(jobdir, pqr_complex_dir, mutid + &#39;.pqr&#39;)</span>
    <span class="c1">#         execPDB2PQR(path_pdb2pqr, infile, outfile=outfile, ff=ff)</span>
    <span class="c1">#         complex_pqr = pd.parsePQR(outfile)</span>
    <span class="c1">#         for sel, seldir in zip(selstr, pqr_sel_dir):</span>
    <span class="c1">#             selfile = os.path.join(jobdir, seldir, mutid + &#39;.pqr&#39;)</span>
    <span class="c1">#             pqr = complex_pqr.select(sel)</span>
    <span class="c1">#             pd.writePQR(selfile, pqr)</span>

<div class="viewcode-block" id="Alascan.calcAPBS"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.calcAPBS">[docs]</a>    <span class="k">def</span> <span class="nf">calcAPBS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Run APBS on each structure in mutant library, in serial.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Stores energies from APBS in Gref and Gsolv class attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_apbs_dir</span>
        <span class="n">path_apbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gsolv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span>

        <span class="c1"># complex_pqr = os.path.join(jobdir, pqr_complex_dir, list_mutids[0] + &#39;.pqr&#39;)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">calculating solvation and reference energies for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="c1"># complex_pqr = os.path.join(jobdir, pqr_complex_dir, mutid+&#39;.pqr&#39;)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="n">path_prefix_log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="c1"># path, pqr_chain, dime, glen, gcent, prefix, ion, pdie, sdie, dx, i, j = kernel</span>
                    <span class="n">energies</span> <span class="o">=</span> <span class="n">execAPBS</span><span class="p">(</span><span class="n">path_apbs</span><span class="p">,</span> <span class="n">subunit_pqr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span><span class="p">,</span>
                                        <span class="n">prefix</span><span class="o">=</span><span class="n">path_prefix_log</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sdie</span><span class="p">,</span>
                                        <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
                    <span class="c1"># print energies[0][0]</span>
                    <span class="c1"># print energies[0][1]</span>
                    <span class="n">Gsolv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">Gref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">Gsolv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gsolv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="n">Gref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gref</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span> <span class="o">=</span> <span class="n">Gsolv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span> <span class="o">=</span> <span class="n">Gref</span></div>

<div class="viewcode-block" id="Alascan.calcAPBS_parallel"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.calcAPBS_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">calcAPBS_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Run APBS on each structure in mutant library, in parallel.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves solvated-state and reference-state free energies as class attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_apbs_dir</span>
        <span class="n">path_apbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span>

        <span class="k">if</span> <span class="n">n_workers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">n_workers</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gsolv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pqr_chain_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dime_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">glen_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gcent_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prefix_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ion_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pdie_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sdie_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dx_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">j_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Find all calculations to be done</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_apbs</span><span class="p">)</span>
                    <span class="n">pqr_chain_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subunit_pqr</span><span class="p">)</span>
                    <span class="n">dime_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dime</span><span class="p">)</span>
                    <span class="n">glen_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glen</span><span class="p">)</span>
                    <span class="n">gcent_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gcent</span><span class="p">)</span>
                    <span class="n">prefix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">_</span><span class="si">%d</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">mutid</span><span class="p">))</span>  <span class="c1"># added to make sure apbs.in file is unique!</span>
                    <span class="n">ion_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ion</span><span class="p">)</span>
                    <span class="n">pdie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdie</span><span class="p">)</span>
                    <span class="n">sdie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sdie</span><span class="p">)</span>
                    <span class="n">dx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
                    <span class="n">i_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">j_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># Organize kernel and run batch process</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_list</span><span class="p">,</span> <span class="n">pqr_chain_list</span><span class="p">,</span> <span class="n">dime_list</span><span class="p">,</span> <span class="n">glen_list</span><span class="p">,</span> <span class="n">gcent_list</span><span class="p">,</span> <span class="n">prefix_list</span><span class="p">,</span> <span class="n">ion_list</span><span class="p">,</span> <span class="n">pdie_list</span><span class="p">,</span>
                     <span class="n">sdie_list</span><span class="p">,</span> <span class="n">dx_list</span><span class="p">,</span> <span class="n">i_list</span><span class="p">,</span> <span class="n">j_list</span><span class="p">)</span>

        <span class="n">apbs_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">running batchAPBS ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">batchAPBS</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;.... </span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">batch APBS </span><span class="si">%d</span><span class="s1"> percent complete ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">counter</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max_count</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">solv</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="c1"># print &#39;%d, %d, %f, %f&#39;%(i, j, solv, ref)</span>
            <span class="n">apbs_results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">solv</span><span class="p">,</span> <span class="n">ref</span><span class="p">])</span>
            <span class="n">Gsolv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">solv</span>
            <span class="n">Gref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="n">apbs_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">apbs_results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apbs_results</span> <span class="o">=</span> <span class="n">apbs_results</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;.dx&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prefix_list</span><span class="p">]</span>

        <span class="c1"># Fill in results that are duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">Gsolv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gsolv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="n">Gref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gref</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span> <span class="o">=</span> <span class="n">Gsolv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span> <span class="o">=</span> <span class="n">Gref</span></div>

<div class="viewcode-block" id="Alascan.calcCoulomb"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.calcCoulomb">[docs]</a>    <span class="k">def</span> <span class="nf">calcCoulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates Coulombic free energies with coulomb.exe from the APBS toolbox.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves Coulombic free energies as a class attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">path_coulomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span>
        <span class="n">pdie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gcoul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">calculating coulombic energies for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                    <span class="n">energies</span> <span class="o">=</span> <span class="n">execCoulomb</span><span class="p">(</span><span class="n">path_coulomb</span><span class="p">,</span> <span class="n">subunit_pqr</span><span class="p">)</span>
                    <span class="n">Gcoul</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span> <span class="o">/</span> <span class="n">pdie</span>

        <span class="c1"># Fill in results that are duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">Gcoul</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gcoul</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gcoul</span> <span class="o">=</span> <span class="n">Gcoul</span></div>

<div class="viewcode-block" id="Alascan.calcCoulomb_parallel"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.calcCoulomb_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">calcCoulomb_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates Coulombic free energies with coulomb.exe from the APBS toolbox in a parallel manner.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves Coulombic free energies as a class attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">path_coulomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span>

        <span class="k">if</span> <span class="n">n_workers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">n_workers</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gcoul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pqr_chain_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pdie_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">j_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Find all calculations to be done</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_coulomb</span><span class="p">)</span>
                    <span class="n">pqr_chain_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subunit_pqr</span><span class="p">)</span>
                    <span class="n">pdie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdie</span><span class="p">)</span>
                    <span class="n">i_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">j_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># Organize kernel and run batch process</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_list</span><span class="p">,</span> <span class="n">pqr_chain_list</span><span class="p">,</span> <span class="n">pdie_list</span><span class="p">,</span> <span class="n">i_list</span><span class="p">,</span> <span class="n">j_list</span><span class="p">)</span>
        <span class="n">coulomb_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_workers</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">running batchCoulomb ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">batchCoulomb</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;.... </span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">batch coulomb </span><span class="si">%d</span><span class="s1"> percent complete ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">counter</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max_count</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">coul</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">coulomb_results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coul</span><span class="p">])</span>
            <span class="n">Gcoul</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">coul</span>
        <span class="n">coulomb_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coulomb_results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb_results</span> <span class="o">=</span> <span class="n">coulomb_results</span>

        <span class="c1"># Fill in results that are duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">Gcoul</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gcoul</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gcoul</span> <span class="o">=</span> <span class="n">Gcoul</span></div>

<div class="viewcode-block" id="Alascan.ddGa_rel"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.ddGa_rel">[docs]</a>    <span class="k">def</span> <span class="nf">ddGa_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates and returns the free energy of association relative to the parent free energy of association.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Array of free energies corresponding to the mutant IDs from the Alascan.getMutIDs() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Gsolv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span>
        <span class="n">Gcoul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gcoul</span>

        <span class="n">dGsolv</span> <span class="o">=</span> <span class="n">Gsolv</span> <span class="o">-</span> <span class="n">Gref</span>

        <span class="n">dGsolu</span> <span class="o">=</span> <span class="n">Gsolv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Gsolv</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dGcoul</span> <span class="o">=</span> <span class="n">Gcoul</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Gcoul</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ddGsolv</span> <span class="o">=</span> <span class="n">dGsolv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dGsolv</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">dGbind</span> <span class="o">=</span> <span class="n">ddGsolv</span> <span class="o">+</span> <span class="n">dGcoul</span>
        <span class="n">dGbind_rel</span> <span class="o">=</span> <span class="n">dGbind</span> <span class="o">-</span> <span class="n">dGbind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dGbind_rel</span></div>

<div class="viewcode-block" id="Alascan.dGsolv_rel"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.dGsolv_rel">[docs]</a>    <span class="k">def</span> <span class="nf">dGsolv_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates and returns the free energy of a solvation for each mutant relative to the parent free energy of solvation.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Array of solvation free energies corresponding to mutant IDs from the Alascan.getMutIDs() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Gsolv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span>
        <span class="n">dGsolv</span> <span class="o">=</span> <span class="n">Gsolv</span> <span class="o">-</span> <span class="n">Gref</span>
        <span class="n">dGsolv</span> <span class="o">=</span> <span class="n">dGsolv</span> <span class="o">-</span> <span class="n">dGsolv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dGsolv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Alascan.run"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Perform a compuational alanine scan on the initialized Alascan class.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Outputs text to STDOUT when run is complete, will be made optional in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genTruncatedPQR</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcAPBS</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcCoulomb</span><span class="p">()</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">AESOP alanine scan completed in </span><span class="si">%.2f</span><span class="s1"> seconds&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span></div>

<div class="viewcode-block" id="Alascan.run_parallel"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.run_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">run_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Perform a computational alanine scan on the initialized Alascan class using multiple processes in parallel.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Outputs text to STDOUT when run is complete, will be made optional in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genTruncatedPQR</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcAPBS_parallel</span><span class="p">(</span><span class="n">n_workers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcCoulomb_parallel</span><span class="p">(</span><span class="n">n_workers</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">AESOP alanine scan completed in </span><span class="si">%.2f</span><span class="s1"> seconds&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span></div>

<div class="viewcode-block" id="Alascan.summary"><a class="viewcode-back" href="../aesop.html#aesop.Alascan.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Summarize results from the computational alanine scan once complete.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str, optional</span>
<span class="sd">            In order to write summary to a text file, supply the filename (full path).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Prints summary of residues and energies relative to the parent structure if no filename is provided. Otherwise, writes to text file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mutids</span><span class="p">,</span> <span class="n">energies</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span></div></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Container for performing an Directed Mutagenesis Scan with AESOP</span>
<span class="c1">#   pdb     -   PDB file for performing Alascan. Must contain all chain selections with standard amino acid nomenclature</span>
<span class="c1">#   selstr  -   List of selection strings for chain selection. This does not change what is mutated.</span>
<span class="c1">#   target  -   List of selection strings for mutants, each will element of list will be mutated simultaneously</span>
<span class="c1">#   mutation -  Mutate each target residue to the corresponding element of this list. (3 letter code)</span>
<span class="c1">#   ion     -   Ionic strength</span>
<span class="c1">#   pdie    -   Protein dielectric constant</span>
<span class="c1">#   sdie    -   Solvent dielectric constant</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="DirectedMutagenesis"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis">[docs]</a><span class="k">class</span> <span class="nc">DirectedMutagenesis</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    apbs : str</span>
<span class="sd">        Full path to APBS executable. Must be compatible with OS.</span>
<span class="sd">    apbs_results : str</span>
<span class="sd">        Full path to output from APBS</span>
<span class="sd">    cfac : numeric</span>
<span class="sd">        Scaling factor for grid dimensions. We suggest to leave this unchanged.</span>
<span class="sd">    coulomb : str</span>
<span class="sd">        Full path to coulomb executable from APBS package. Must be compatible with OS.</span>
<span class="sd">    coulomb_results : str</span>
<span class="sd">        Full path to folder containing results from coulomb.</span>
<span class="sd">    dime : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    dx : bool</span>
<span class="sd">        Variable that specifies if potential files should be written to disk. Default is False.</span>
<span class="sd">    dx_files : list</span>
<span class="sd">        If written to disk, list of potential files written to disk. The folder containing these files is given by Alascan.apbs_results.</span>
<span class="sd">    E_ref : ndarray</span>
<span class="sd">        Description</span>
<span class="sd">    E_solv : ndarray</span>
<span class="sd">        Description</span>
<span class="sd">    ff : str</span>
<span class="sd">        Force-field to use for PDB2PQR</span>
<span class="sd">    file_pdb_template : TYPE</span>
<span class="sd">        Description</span>
<span class="sd">    gcent : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    Gcoul : ndarray</span>
<span class="sd">        Coulombic free energies, corresponding to Alascan.mutid.</span>
<span class="sd">    glen : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    Gref : ndarray</span>
<span class="sd">        Reference-state free energies, corresponding to Alascan.mutid.</span>
<span class="sd">    grid : numeric</span>
<span class="sd">        Distance spacing of grid points. If the grid dimensions are not divisible by three, resolution will be increased (smaller grid spacing) until grid dimensions are divisible by three.</span>
<span class="sd">    Gsolv : ndarray</span>
<span class="sd">        Solvated-state free energies, corresponding to Alascan.mutid.</span>
<span class="sd">    ion : numeric</span>
<span class="sd">        Ionic strength to be used in the solvated-state APBS calculations.</span>
<span class="sd">    jobdir : str</span>
<span class="sd">        [Optional] Path to folder containing results. If not specified, a directory will be generated.</span>
<span class="sd">    jobname : str</span>
<span class="sd">        [Optional] Name for current job, will be used to create the jobdir.</span>
<span class="sd">    list_chids : list</span>
<span class="sd">        Chain ID where mutation was made. Corresponds to Alascan.mutid.</span>
<span class="sd">    list_resnames : list</span>
<span class="sd">        Residue names where mutation was made. Corresponds to Alascan.mutid.</span>
<span class="sd">    list_resnums : list</span>
<span class="sd">        Residue numbers where mutation was made. Corresponds to Alascan.mutic.</span>
<span class="sd">    logs_apbs_dir : str</span>
<span class="sd">        Folder in jobdir containing output from APBS (logs, input files, dx files)</span>
<span class="sd">    mask_by_sel : ndarray</span>
<span class="sd">        Matrix containing selection masks. The first column corresponds to the selection string for the parent and each column thereafter corresponds to an element of the selection string (selstr) in the same order.</span>
<span class="sd">    mutation : list</span>
<span class="sd">        Identity of amino acid for mutation of corresponding target. Must be the same length as target and each residue must use the standard 3-letter amino acid code.</span>
<span class="sd">    mutid : list</span>
<span class="sd">        List of mutant IDs. The first element corresponds to the parent. Subsequent elements correspond to each element of the selection string list (selstr). Please use Alascan.getMutids() to get vectorized version.</span>
<span class="sd">    pdb : str</span>
<span class="sd">        Path to PDB file with atomic coordinates. Must follow formatting conventions of the Protein Databank.</span>
<span class="sd">    pdb2pqr : str</span>
<span class="sd">        Full path to PDB2PQR executable.</span>
<span class="sd">    pdb_complex_dir : str</span>
<span class="sd">        Folder name in the job directory that contains the PDB file(s) of the complex structures.</span>
<span class="sd">    pdie : numeric</span>
<span class="sd">        Protein dielectric constant to be used in APBS.</span>
<span class="sd">    pqr_complex_dir : str</span>
<span class="sd">        Folder name in the job directory containing PQR files for each protein complex.</span>
<span class="sd">    pqr_sel_dir : list</span>
<span class="sd">        List of folder names in the job directory that contain PQR files for selection strings (selstr). Each element of pqr_sel_dir corresponds to the same element of selstr.</span>
<span class="sd">    sdie : numeric</span>
<span class="sd">        Solvent dielectric constant to be used in APBS.</span>
<span class="sd">    selstr : list</span>
<span class="sd">        List of selection strings. Typically each selection string will correspond to a chain in a protein complex. We advise users to specify two or more selection strings. (Ex: [&#39;chain A&#39;, &#39;chain B&#39;])</span>
<span class="sd">    target : list</span>
<span class="sd">        List of residue numbers to mutate. Must correspond element-wise to mutation attribute.</span>
<span class="sd">    </span>
<span class="sd">    Deleted Attributes</span>
<span class="sd">    ------------------</span>
<span class="sd">    dirs : int</span>
<span class="sd">        Description</span>
<span class="sd">    prefix : TYPE</span>
<span class="sd">        Description</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mutation</span><span class="p">,</span> <span class="n">pdb2pqr_exe</span><span class="p">,</span> <span class="n">apbs_exe</span><span class="p">,</span> <span class="n">coulomb_exe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selstr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;protein&#39;</span><span class="p">],</span> <span class="n">jobname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">grid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="mf">0.150</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="mf">78.54</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;parse&#39;</span><span class="p">,</span> <span class="n">cfac</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pdb : str</span>
<span class="sd">            The pdb file for which a computational alanine scan will be performed.</span>
<span class="sd">        target : list</span>
<span class="sd">            List of residue numbers to mutate. Must correspond element-wise to mutation attribute.</span>
<span class="sd">        mutation : list</span>
<span class="sd">            Identity of amino acid for mutation of corresponding target. Must be the same length as target and each residue must use the standard 3-letter amino acid code.</span>
<span class="sd">        pdb2pqr_exe : str</span>
<span class="sd">            Path to executable for PDB2PQR.</span>
<span class="sd">        apbs_exe : str</span>
<span class="sd">            Path to executable for APBS</span>
<span class="sd">        coulomb_exe : str, optional</span>
<span class="sd">            Path to executable for Coulomb from the APBS toolbox.</span>
<span class="sd">        selstr : list, optional</span>
<span class="sd">            List of selection strings. Typically each selection string will correspond to a chain in a protein complex. We advise users to specify two or more selection strings. The default selection will only investigate solvation free energies as there will be no binding event. (Ex: [&#39;chain A&#39;, &#39;chain B&#39;])</span>
<span class="sd">        jobname : str, optional</span>
<span class="sd">            A string representing the full path to the directory where results will be stored.</span>
<span class="sd">        grid : int, optional</span>
<span class="sd">            Desired grid spacing to be used in APBS. Depending on the PDB file, actual grid spacing may be a finer resolution. Defaults to 1 angstrom.</span>
<span class="sd">        ion : float, optional</span>
<span class="sd">            Ionic strength (M) to be used in APBS.</span>
<span class="sd">        pdie : float, optional</span>
<span class="sd">            Protein dielectric constant to be used in APBS.</span>
<span class="sd">        sdie : float, optional</span>
<span class="sd">            Solvent dielectric constant to be used in APBS&gt;</span>
<span class="sd">        ff : str, optional</span>
<span class="sd">            Force field to assign charges to individual atoms. We recommend using PARSE for this analysis, the default value.</span>
<span class="sd">        cfac : float, optional</span>
<span class="sd">            Scaling factor for grid dimension. This generally should not be changed without a reason.</span>
<span class="sd">        dx : bool, optional</span>
<span class="sd">            Boolean flag stating if potential files should be written to disk (True) or not (False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb2pqr</span> <span class="o">=</span> <span class="n">pdb2pqr_exe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span> <span class="o">=</span> <span class="n">apbs_exe</span>
        <span class="k">if</span> <span class="n">coulomb_exe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">apbs_exe</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span> <span class="o">=</span> <span class="n">coulomb_exe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span> <span class="o">=</span> <span class="n">selstr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span> <span class="o">=</span> <span class="n">mutation</span>
        <span class="c1"># if region is None:</span>
        <span class="c1">#     self.region = selstr</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.region = region</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ion</span> <span class="o">=</span> <span class="n">ion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span> <span class="o">=</span> <span class="n">pdie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sdie</span> <span class="o">=</span> <span class="n">sdie</span>
        <span class="k">if</span> <span class="n">jobname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%4d%02d%02d</span><span class="s1">_</span><span class="si">%02d%02d%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobname</span> <span class="o">=</span> <span class="n">jobname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span> <span class="o">=</span> <span class="n">jobname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_solv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span> <span class="o">=</span> <span class="n">cfac</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">genDirs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genMutid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_grid</span><span class="p">()</span>

<div class="viewcode-block" id="DirectedMutagenesis.getMutids"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.getMutids">[docs]</a>    <span class="k">def</span> <span class="nf">getMutids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Returns vectorized format of mutids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.genDirs"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.genDirs">[docs]</a>    <span class="k">def</span> <span class="nf">genDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        This subroutine will generate all directories needed to contain structural files, logs, etc. In the future we may implement a method to remove such files when outputs are more standardized.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            No output, operates on the class and generates folders in the job directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create necessary directories for PDB files</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="s1">&#39;complex_pdb&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="n">pdb_complex_dir</span>

        <span class="c1"># Create necessary directories for PQR files</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="s1">&#39;complex_pqr&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">))</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selstr</span><span class="p">)):</span>
            <span class="n">pqr_sel_dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">_pqr&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">_pqr&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;seg</span><span class="si">%d</span><span class="s1">_pqr&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="n">pqr_complex_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="n">pqr_sel_dir</span>

        <span class="c1"># Create necessary directories for APBS files</span>
        <span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="s1">&#39;apbs_logs&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="s1">&#39;apbs_logs&#39;</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.genMutid"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.genMutid">[docs]</a>    <span class="k">def</span> <span class="nf">genMutid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        This subroutine reads the input PDB, selects the structure where mutations will occur, and saves all mutant IDs in the class. If region is specified in the constructor, then the constraint will be applied here.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Operates on the class to generate a list of mutant IDs for each selection string. The following class variables will be generated (see class description):</span>
<span class="sd">            	- mutid</span>
<span class="sd">            	- list_chids</span>
<span class="sd">            	- list_resnums</span>
<span class="sd">            	- list_resnames</span>
<span class="sd">            	- mask_by_sel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="n">mutation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span>

        <span class="n">parent_file_prefix</span> <span class="o">=</span> <span class="s1">&#39;wt&#39;</span>
        <span class="n">parent_pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="p">)</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">list_chids</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">list_resnums</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">list_resnames</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">dim_mut</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mut</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_file_prefix</span><span class="p">]</span>
        <span class="n">list_chids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="n">list_resnums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="n">list_resnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)),</span> <span class="n">selstr</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="n">mut</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="p">)),</span> <span class="n">target</span><span class="p">,</span> <span class="n">mutation</span><span class="p">):</span>
                <span class="n">combined_selection</span> <span class="o">=</span> <span class="n">parent_pdb</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sel</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;calpha&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">combined_selection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">chids</span> <span class="o">=</span> <span class="n">combined_selection</span><span class="o">.</span><span class="n">getChids</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">resnums</span> <span class="o">=</span> <span class="n">combined_selection</span><span class="o">.</span><span class="n">getResnums</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">resnames</span> <span class="o">=</span> <span class="n">combined_selection</span><span class="o">.</span><span class="n">getResnames</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;sel</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">resname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">resnums</span><span class="p">,</span> <span class="n">resnames</span><span class="p">):</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">label</span><span class="p">,</span> <span class="n">AA_dict</span><span class="p">[</span><span class="n">resname</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">resnum</span><span class="p">)</span><span class="o">+</span><span class="n">AA_dict</span><span class="p">[</span><span class="n">mut</span><span class="p">]])</span>

                    <span class="n">list_mutids</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                    <span class="n">list_chids</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chids</span><span class="p">)</span>
                    <span class="n">list_resnums</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resnums</span><span class="p">)</span>
                    <span class="n">list_resnames</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resnames</span><span class="p">)</span>
                    <span class="n">mask_by_sel</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="o">=</span> <span class="n">list_mutids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_chids</span> <span class="o">=</span> <span class="n">list_chids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_resnums</span> <span class="o">=</span> <span class="n">list_resnums</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_resnames</span> <span class="o">=</span> <span class="n">list_resnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">mask_by_sel</span></div>
        <span class="c1"># self.gcent = None</span>
        <span class="c1"># self.dime = None</span>
        <span class="c1"># self.glen = None</span>

<div class="viewcode-block" id="DirectedMutagenesis.genParent"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.genParent">[docs]</a>    <span class="k">def</span> <span class="nf">genParent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Reads PDB file specified in the constructor; applies and combines results from the selection strings; and saves the final template structure in the job directory.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Template pdb written in job directory and location saved in Alascan.file_pdb_template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span>

        <span class="n">parent_file_prefix</span> <span class="o">=</span> <span class="s1">&#39;wt&#39;</span>
        <span class="n">parent_pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="p">)</span>

        <span class="c1"># list_mutids = [item for sublist in self.mutid for item in sublist]</span>
        <span class="c1"># list_chids = [item for sublist in self.list_chids for item in sublist]</span>
        <span class="c1"># list_resnums = [item for sublist in self.list_resnums for item in sublist]</span>

        <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">,</span> <span class="n">parent_file_prefix</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">parent_pdb</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;((&#39;</span> <span class="o">+</span> <span class="s1">&#39;) or (&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;))&#39;</span><span class="p">)</span>
        <span class="c1"># print &#39;((&#39;+&#39;) or (&#39;.join(selstr)+&#39;))&#39;</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_pdb_template</span> <span class="o">=</span> <span class="n">infile</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.find_grid"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.find_grid">[docs]</a>    <span class="k">def</span> <span class="nf">find_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculate grid dimensions for APBS (dime, glen, gcent)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Sets class attributes dime, glen, and gcent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_pdb_template</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
        <span class="n">cfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span>

        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Find bounding box</span>
        <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
        <span class="n">max_xyz</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">min_xyz</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Determine mesh dimensions according to Ron&#39;s AESOP protocol in the R source file</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_xyz</span> <span class="o">-</span> <span class="n">min_xyz</span><span class="p">)</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">fg</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">cfac</span><span class="p">)</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">glen</span><span class="p">,</span> <span class="n">fg</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dime_list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># list of possible dime values</span>
        <span class="n">dime_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">glen</span> <span class="o">/</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">grid</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># index of dime to use from list, subtract one to be consistent with python indexing!</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])]))</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">((</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iy</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iz</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dime</span> <span class="o">=</span> <span class="n">dime</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glen</span> <span class="o">=</span> <span class="n">glen</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">calcCenter</span><span class="p">(</span><span class="n">pdb</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.set_grid"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.set_grid">[docs]</a>    <span class="k">def</span> <span class="nf">set_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dime</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        In the case that the user wishes to manually specify grid dimension, this may be accomplished with the set_grid method. Typically, this is used when grid space parameters must be consistent for many analyses. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/ for description of parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dime : list</span>
<span class="sd">            List of three integers.</span>
<span class="sd">        glen : list</span>
<span class="sd">            List of three integers.</span>
<span class="sd">        gcent : list</span>
<span class="sd">            List of three integers.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Sets class attributes for dime, glen, gcent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dime</span> <span class="o">=</span> <span class="n">dime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glen</span> <span class="o">=</span> <span class="n">glen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span> <span class="o">=</span> <span class="n">gcent</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.genPDB"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.genPDB">[docs]</a>    <span class="k">def</span> <span class="nf">genPDB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Generates mutations by calling function to mutate PDB with modeller</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Write PDB library to expected path according to class attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span>
        <span class="n">mutation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span>

        <span class="n">parent_file_prefix</span> <span class="o">=</span> <span class="s1">&#39;wt&#39;</span>
        <span class="n">parent_pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="p">)</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">list_chids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_chids</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">list_resnums</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_resnums</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">,</span> <span class="n">parent_file_prefix</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">parent_pdb</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="s1">&#39;) or (&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mutid</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">mut</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">list_chids</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">list_resnums</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">mutation</span><span class="p">):</span>
            <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">generating PDB for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="n">mutatePDB</span><span class="p">(</span><span class="n">pdb</span><span class="o">=</span><span class="n">infile</span><span class="p">,</span> <span class="n">mutid</span><span class="o">=</span><span class="n">outpath</span><span class="p">,</span> <span class="n">resnum</span><span class="o">=</span><span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span> <span class="n">resid</span><span class="o">=</span><span class="n">mut</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.genPQR"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.genPQR">[docs]</a>    <span class="k">def</span> <span class="nf">genPQR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Generates PQR for each PDB in library.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Calls PDB2PQR and writes PQR to expected path according to class attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pdb_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_complex_dir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">path_pdb2pqr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb2pqr</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutid</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="c1"># Calculate PQR of complexes</span>
        <span class="k">for</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="n">list_mutids</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">generating PQR for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pdb_complex_dir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
            <span class="n">execPDB2PQR</span><span class="p">(</span><span class="n">path_pdb2pqr</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="n">ff</span><span class="p">)</span>
            <span class="n">complex_pqr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePQR</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sel</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selstr</span><span class="p">,</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">selfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="n">pqr</span> <span class="o">=</span> <span class="n">complex_pqr</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">writePQR</span><span class="p">(</span><span class="n">selfile</span><span class="p">,</span> <span class="n">pqr</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.calcAPBS"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.calcAPBS">[docs]</a>    <span class="k">def</span> <span class="nf">calcAPBS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Call apbs to calculate reference-state and solvation-state energies for all structures in library.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Sets class attributes Gsolv and Gref</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_apbs_dir</span>
        <span class="n">path_apbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gsolv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span>

        <span class="n">complex_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">,</span> <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">calculating solvation and reference energies for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="c1"># complex_pqr = os.path.join(jobdir, pqr_complex_dir, mutid+&#39;.pqr&#39;)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="n">path_prefix_log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
                <span class="n">energies</span> <span class="o">=</span> <span class="n">execAPBS</span><span class="p">(</span><span class="n">path_apbs</span><span class="p">,</span> <span class="n">subunit_pqr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">glen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span><span class="p">,</span>
                                        <span class="n">prefix</span><span class="o">=</span><span class="n">path_prefix_log</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sdie</span><span class="p">,</span>
                                        <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
                <span class="n">Gsolv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Gref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># if mask_by_sel[i, j]:</span>
                <span class="c1">#     energies = execAPBS(path_apbs, subunit_pqr, complex_pqr, prefix=path_prefix_log, grid=self.grid,</span>
                <span class="c1">#                         ion=self.ion, pdie=self.pdie, sdie=self.sdie, cfac=self.cfac)</span>
                <span class="c1">#     # print energies[0][0]</span>
                <span class="c1">#     # print energies[0][1]</span>
                <span class="c1">#     Gsolv[i, j] = energies[0][0]</span>
                <span class="c1">#     Gref[i, j] = energies[0][1]</span>
                <span class="c1"># if not mask_by_sel[i, j]:</span>
                <span class="c1">#     Gsolv[i, j] = Gsolv[0, j]</span>
                <span class="c1">#     Gref[i, j] = Gref[0, j]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span> <span class="o">=</span> <span class="n">Gsolv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span> <span class="o">=</span> <span class="n">Gref</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.calcAPBS_parallel"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.calcAPBS_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">calcAPBS_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Run APBS on each structure in mutant library, in parallel.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves solvated-state and reference-state free energies as class attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">logs_apbs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_apbs_dir</span>
        <span class="n">path_apbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gsolv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pqr_chain_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dime_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">glen_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gcent_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prefix_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ion_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pdie_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sdie_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dx_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">j_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Find all calculations to be done</span>
        <span class="n">complex_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">pqr_complex_dir</span><span class="p">,</span> <span class="n">list_mutids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="c1"># if mask_by_sel[i, j]: # NOT NEEDED FOR DIRECTED MUTATIONS: modeller will rearrange structure slightly</span>
                <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_apbs</span><span class="p">)</span>
                <span class="n">pqr_chain_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subunit_pqr</span><span class="p">)</span>
                <span class="n">dime_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dime</span><span class="p">)</span>
                <span class="n">glen_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glen</span><span class="p">)</span>
                <span class="n">gcent_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gcent</span><span class="p">)</span>
                <span class="n">prefix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">logs_apbs_dir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">_</span><span class="si">%d</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">mutid</span><span class="p">))</span>  <span class="c1"># added to make sure apbs.in file is unique!</span>
                <span class="n">ion_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ion</span><span class="p">)</span>
                <span class="n">pdie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdie</span><span class="p">)</span>
                <span class="n">sdie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sdie</span><span class="p">)</span>
                <span class="n">dx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
                <span class="n">i_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">j_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># Organize kernel and run batch process</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_list</span><span class="p">,</span> <span class="n">pqr_chain_list</span><span class="p">,</span> <span class="n">dime_list</span><span class="p">,</span> <span class="n">glen_list</span><span class="p">,</span> <span class="n">gcent_list</span><span class="p">,</span> <span class="n">prefix_list</span><span class="p">,</span> <span class="n">ion_list</span><span class="p">,</span> <span class="n">pdie_list</span><span class="p">,</span>
                     <span class="n">sdie_list</span><span class="p">,</span> <span class="n">dx_list</span><span class="p">,</span> <span class="n">i_list</span><span class="p">,</span> <span class="n">j_list</span><span class="p">)</span>
        <span class="n">apbs_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_workers</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">running batchAPBS ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">batchAPBS</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;.... </span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">batch APBS </span><span class="si">%d</span><span class="s1"> percent complete ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">counter</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max_count</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">solv</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="c1"># print &#39;%d, %d, %f, %f&#39;%(i, j, solv, ref)</span>
            <span class="n">apbs_results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">solv</span><span class="p">,</span> <span class="n">ref</span><span class="p">])</span>
            <span class="n">Gsolv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">solv</span>
            <span class="n">Gref</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
        <span class="n">apbs_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">apbs_results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apbs_results</span> <span class="o">=</span> <span class="n">apbs_results</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;.dx&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prefix_list</span><span class="p">]</span>

        <span class="c1"># # Fill in results that are duplicates # NOT NEEDED FOR DIRECTED MUTATIONS: modeller will rearrange structure slightly</span>
        <span class="c1"># for i in xrange(dim_mutid):</span>
        <span class="c1">#     for j in xrange(dim_sel):</span>
        <span class="c1">#         if not mask_by_sel[i, j]:</span>
        <span class="c1">#             Gsolv[i, j] = Gsolv[0, j]</span>
        <span class="c1">#             Gref[i, j] = Gref[0, j]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span> <span class="o">=</span> <span class="n">Gsolv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span> <span class="o">=</span> <span class="n">Gref</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.calcCoulomb"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.calcCoulomb">[docs]</a>    <span class="k">def</span> <span class="nf">calcCoulomb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates Coulombic free energies with coulomb.exe from the APBS toolbox.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves Coulombic free energies as a class attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">path_coulomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span>
        <span class="n">pdie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">Gcoul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">calculating coulombic energies for mutant: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">mutid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="n">energies</span> <span class="o">=</span> <span class="n">execCoulomb</span><span class="p">(</span><span class="n">path_coulomb</span><span class="p">,</span> <span class="n">subunit_pqr</span><span class="p">)</span>
                <span class="n">Gcoul</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span> <span class="o">/</span> <span class="n">pdie</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gcoul</span> <span class="o">=</span> <span class="n">Gcoul</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.calcCoulomb_parallel"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.calcCoulomb_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">calcCoulomb_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates Coulombic free energies with coulomb.exe from the APBS toolbox in a parallel manner.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Saves Coulombic free energies as a class attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selstr</span>
        <span class="n">jobdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span>
        <span class="n">pqr_complex_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_complex_dir</span>
        <span class="n">pqr_sel_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqr_sel_dir</span>
        <span class="n">path_coulomb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coulomb</span>

        <span class="n">list_mutids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMutids</span><span class="p">()</span>

        <span class="n">dim_mutid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_mutids</span><span class="p">)</span>
        <span class="n">dim_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">selstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">mask_by_sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">)</span>  <span class="c1"># Mask parts that are true will be run with APBS</span>
        <span class="n">mask_by_sel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="n">Gcoul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim_mutid</span><span class="p">,</span> <span class="n">dim_sel</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pqr_chain_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pdie_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">j_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Find all calculations to be done</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_mutid</span><span class="p">),</span> <span class="n">list_mutids</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">seldir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">dim_sel</span><span class="p">),</span> <span class="p">[</span><span class="n">pqr_complex_dir</span><span class="p">]</span> <span class="o">+</span> <span class="n">pqr_sel_dir</span><span class="p">):</span>
                <span class="n">subunit_pqr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">jobdir</span><span class="p">,</span> <span class="n">seldir</span><span class="p">,</span> <span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
                <span class="c1"># if mask_by_sel[i, j]: # NOT NEEDED FOR DIRECTED MUTATIONS: modeller will rearrange structure slightly</span>
                <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_coulomb</span><span class="p">)</span>
                <span class="n">pqr_chain_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subunit_pqr</span><span class="p">)</span>
                <span class="n">pdie_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdie</span><span class="p">)</span>
                <span class="n">i_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">j_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># Organize kernel and run batch process</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_list</span><span class="p">,</span> <span class="n">pqr_chain_list</span><span class="p">,</span> <span class="n">pdie_list</span><span class="p">,</span> <span class="n">i_list</span><span class="p">,</span> <span class="n">j_list</span><span class="p">)</span>
        <span class="n">coulomb_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_workers</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">running batchCoulomb ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">batchCoulomb</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;.... </span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">batch coulomb </span><span class="si">%d</span><span class="s1"> percent complete ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">counter</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max_count</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">coul</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">coulomb_results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coul</span><span class="p">])</span>
            <span class="n">Gcoul</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">coul</span>
        <span class="n">coulomb_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coulomb_results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coulomb_results</span> <span class="o">=</span> <span class="n">coulomb_results</span>

        <span class="c1"># Fill in results that are duplicates # NOT NEEDED FOR DIRECTED MUTATIONS: modeller will rearrange structure slightly</span>
        <span class="c1"># for i in xrange(dim_mutid):</span>
        <span class="c1">#     for j in xrange(dim_sel):</span>
        <span class="c1">#         if not mask_by_sel[i, j]:</span>
        <span class="c1">#             Gcoul[i, j] = Gcoul[0, j]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gcoul</span> <span class="o">=</span> <span class="n">Gcoul</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.ddGa_rel"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.ddGa_rel">[docs]</a>    <span class="k">def</span> <span class="nf">ddGa_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates and returns the free energy of association relative to the parent free energy of association.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Array of free energies corresponding to the mutant IDs from the Alascan.getMutIDs() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Gsolv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span>
        <span class="n">Gcoul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gcoul</span>

        <span class="n">dGsolv</span> <span class="o">=</span> <span class="n">Gsolv</span> <span class="o">-</span> <span class="n">Gref</span>

        <span class="n">dGsolu</span> <span class="o">=</span> <span class="n">Gsolv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Gsolv</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dGcoul</span> <span class="o">=</span> <span class="n">Gcoul</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Gcoul</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ddGsolv</span> <span class="o">=</span> <span class="n">dGsolv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dGsolv</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">dGbind</span> <span class="o">=</span> <span class="n">ddGsolv</span> <span class="o">+</span> <span class="n">dGcoul</span>
        <span class="n">dGbind_rel</span> <span class="o">=</span> <span class="n">dGbind</span> <span class="o">-</span> <span class="n">dGbind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dGbind_rel</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.dGsolv_rel"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.dGsolv_rel">[docs]</a>    <span class="k">def</span> <span class="nf">dGsolv_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Calculates and returns the free energy of a solvation for each mutant relative to the parent free energy of solvation.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Array of solvation free energies corresponding to mutant IDs from the Alascan.getMutIDs() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Gsolv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gsolv</span>
        <span class="n">Gref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gref</span>
        <span class="n">dGsolv</span> <span class="o">=</span> <span class="n">Gsolv</span> <span class="o">-</span> <span class="n">Gref</span>
        <span class="n">dGsolv</span> <span class="o">=</span> <span class="n">dGsolv</span> <span class="o">-</span> <span class="n">dGsolv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dGsolv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.run"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Perform a directed mutagenesis scan on the initialized class.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Outputs text to STDOUT when run is complete, will be made optional in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="c1"># self.genDirs()</span>
        <span class="c1"># self.genMutid()</span>
        <span class="c1"># self.genParent()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genPDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genPQR</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcAPBS</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcCoulomb</span><span class="p">()</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">AESOP directed mutagenesis scan completed in </span><span class="si">%.2f</span><span class="s1"> seconds&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedMutagenesis.run_parallel"><a class="viewcode-back" href="../aesop.html#aesop.DirectedMutagenesis.run_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">run_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Perform a computational directed mutagenesis scan on the initialized class using multiple processes in parallel.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Outputs text to STDOUT when run is complete, will be made optional in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="c1"># self.genDirs()</span>
        <span class="c1"># self.genMutid()  # contains warning: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison if tokens[0] == &#39;and&#39; or tokens[-1] == &#39;and&#39;:</span>
        <span class="c1"># self.genParent()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genPDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genPQR</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcAPBS_parallel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcCoulomb_parallel</span><span class="p">()</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">AESOP directed mutagenesis scan completed in </span><span class="si">%.2f</span><span class="s1"> seconds&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span></div></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Container for performing ESD analysis on set of PDB files</span>
<span class="c1">#   alascan     -   Alascan class with certain class functions.</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="ElecSimilarity"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity">[docs]</a><span class="k">class</span> <span class="nc">ElecSimilarity</span><span class="p">:</span> <span class="c1"># PLEASE SUPERPOSE SYSTEM BEFORE USING THIS METHOD! Coordinates must be consistent!</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    apbs : str</span>
<span class="sd">        Full path to APBS executable. Must be compatible with OS.</span>
<span class="sd">    cfac : numeric</span>
<span class="sd">        Scaling factor for grid dimensions. We suggest to leave this unchanged.</span>
<span class="sd">    dim_dx : list</span>
<span class="sd">        Dimensions of grid space</span>
<span class="sd">    dime : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    dx : bool</span>
<span class="sd">        Variable that specifies if potential files should be written to disk. Default is False.</span>
<span class="sd">    dxdir : str</span>
<span class="sd">        Folder in job directory where potential files are stored.</span>
<span class="sd">    dxfiles : list</span>
<span class="sd">        List of all potential files.</span>
<span class="sd">    edges : ndarray</span>
<span class="sd">        Edges of grid space.</span>
<span class="sd">    esd : ndarray</span>
<span class="sd">        Matrix of pairwise electrostatic similarities.</span>
<span class="sd">    ff : str</span>
<span class="sd">        Forcefield to use in assigning charges to PDB files.</span>
<span class="sd">    gcent : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    glen : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    grid : int</span>
<span class="sd">        Desired grid spacing in Angstroms. Actual grid spacing may be slightly lower.</span>
<span class="sd">    ids : list</span>
<span class="sd">        List of IDs for each structure being compared with the ESD metric.</span>
<span class="sd">    ion : numeric</span>
<span class="sd">        Ionic strength to be used in the solvated-state APBS calculations.</span>
<span class="sd">    jobdir : TYPE</span>
<span class="sd">        Description</span>
<span class="sd">    jobname : str</span>
<span class="sd">        [Optional] Name for current job, will be used to create the jobdir.</span>
<span class="sd">    midpoints : ndarray</span>
<span class="sd">        Midpoints of grid space</span>
<span class="sd">    pdb2pqr : str</span>
<span class="sd">        Full path to PDB2PQR executable.</span>
<span class="sd">    pdbdir : str</span>
<span class="sd">        Folder in job directory where PDB files are located.</span>
<span class="sd">    pdbfiles : list</span>
<span class="sd">        List of PDB file names.</span>
<span class="sd">    pdie : numeric</span>
<span class="sd">        Protein dielectric constant to be used in APBS.</span>
<span class="sd">    pqrdir : str</span>
<span class="sd">        Folder in job directory containing PQR files.</span>
<span class="sd">    sdie : numeric</span>
<span class="sd">        Solvent dielectric constant to be used in APBS.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbfiles</span><span class="p">,</span> <span class="n">pdb2pqr_exe</span><span class="p">,</span> <span class="n">apbs_exe</span><span class="p">,</span> <span class="n">selstr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">jobname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">grid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="mf">0.150</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="mf">78.54</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;parse&#39;</span><span class="p">,</span> <span class="n">cfac</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Constructor for ElecSimilarity class. Responsible for preliminary parameterization.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pdbfiles : list</span>
<span class="sd">            List of file names for all PDBs to be compared. Each string should be a full path if not in the current working directory.</span>
<span class="sd">        pdb2pqr_exe : str</span>
<span class="sd">            Full path to PDB2PQR executable.</span>
<span class="sd">        apbs_exe : TYPE</span>
<span class="sd">            Full path to APBS executable. Must be compatible with OS.</span>
<span class="sd">        selstr : list, optional</span>
<span class="sd">            List of selection strings. Each element should correspond element-wise with the PDB from pdbfiles.</span>
<span class="sd">        jobname : None, optional</span>
<span class="sd">            [Optional] Name for current job, will be used to create the jobdir.</span>
<span class="sd">        grid : int, optional</span>
<span class="sd">            Distance spacing of grid points. If the grid dimensions are not divisible by three, resolution will be increased (smaller grid spacing) until grid dimensions are divisible by three.</span>
<span class="sd">        ion : float, optional</span>
<span class="sd">            Ionic strength (M) to be used in APBS.</span>
<span class="sd">        pdie : float, optional</span>
<span class="sd">            Protein dielectric constant to be used in APBS.</span>
<span class="sd">        sdie : float, optional</span>
<span class="sd">            Solvent dielectric constant to be used in APBS.</span>
<span class="sd">        ff : str, optional</span>
<span class="sd">            Force field to assign charges to individual atoms. We recommend using PARSE for this analysis, the default value.</span>
<span class="sd">        cfac : float, optional</span>
<span class="sd">            Scaling factor for grid dimensions. We suggest to leave this unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb2pqr</span> <span class="o">=</span> <span class="n">pdb2pqr_exe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span> <span class="o">=</span> <span class="n">apbs_exe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">jobname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%4d%02d%02d</span><span class="s1">_</span><span class="si">%02d%02d%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                                                         <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                                                         <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobname</span> <span class="o">=</span> <span class="n">jobname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span> <span class="o">=</span> <span class="n">jobname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;pdb_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqrdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;pqr_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobdir</span><span class="p">,</span> <span class="s1">&#39;dx_files&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pqrdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pqrdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxdir</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pdbfiles</span><span class="p">)),</span> <span class="n">pdbfiles</span><span class="p">):</span>
            <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selstr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)),</span> <span class="n">pdb</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">selstr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)),</span> <span class="n">pdb</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selstr</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ion</span> <span class="o">=</span> <span class="n">ion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span> <span class="o">=</span> <span class="n">pdie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sdie</span> <span class="o">=</span> <span class="n">sdie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span> <span class="o">=</span> <span class="n">cfac</span>

<div class="viewcode-block" id="ElecSimilarity.centerPDB"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.centerPDB">[docs]</a>    <span class="k">def</span> <span class="nf">centerPDB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Re-reads PDB file in pdbdir and centers coordinates at (0, 0, 0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Overwrites previous PDB files in pdbdir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span>
        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>
        <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">:</span>
            <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">))</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">moveAtoms</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">),</span> <span class="n">pdb</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElecSimilarity.superposePDB"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.superposePDB">[docs]</a>    <span class="k">def</span> <span class="nf">superposePDB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Superpose each structure in pdbfiles with first element in pdbfiles list. This method will fail if the number of alpha carbons are not equal in each PDB being compared.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Overwrites PDB files in pdbdir with new coordinate information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span>
        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>

        <span class="c1"># Find minimum number of calphas</span>
        <span class="n">num_res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">numResidues</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">:</span>
            <span class="n">num_res</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_res</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">))</span><span class="o">.</span><span class="n">numResidues</span><span class="p">())</span>
        <span class="k">print</span> <span class="s1">&#39;Superposing </span><span class="si">%d</span><span class="s1"> PDB files on </span><span class="si">%d</span><span class="s1"> alpha carbons&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pdbfiles</span><span class="p">),</span> <span class="n">num_res</span><span class="p">)</span>

        <span class="c1"># Superpose each structure, overwriting previous PDB file</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;calpha&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">:</span>
            <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">calpha</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">calcTransformation</span><span class="p">(</span><span class="n">coords</span><span class="p">[:</span><span class="n">num_res</span><span class="p">],</span> <span class="n">ref</span><span class="p">[:</span><span class="n">num_res</span><span class="p">])</span>
            <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">applyTransformation</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">pdb</span><span class="p">)</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">writePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">),</span> <span class="n">pdb</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElecSimilarity.initializeGrid"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.initializeGrid">[docs]</a>    <span class="k">def</span> <span class="nf">initializeGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Method to find grid parameters and ensure that the product of dimensions is divisible by three.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Sets class attributes dime, glen, gcent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span>
        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
        <span class="n">cfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span>

        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Find bounding box</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">max_xyz</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">min_xyz</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">:</span>
            <span class="n">pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">))</span>
            <span class="n">max_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">max_xyz</span><span class="p">,</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">min_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">min_xyz</span><span class="p">,</span> <span class="n">pdb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Determine mesh dimensions according to Ron&#39;s AESOP protocol in the R source file</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_xyz</span> <span class="o">-</span> <span class="n">min_xyz</span><span class="p">)</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">fg</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">cfac</span><span class="p">)</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">glen</span><span class="p">,</span> <span class="n">fg</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dime_list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># list of possible dime values</span>
        <span class="n">dime_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">glen</span> <span class="o">/</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">grid</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># index of dime to use from list, subtract one to be consistent with python indexing!</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])]))</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">((</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iy</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iz</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dime</span> <span class="o">=</span> <span class="n">dime</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glen</span> <span class="o">=</span> <span class="n">glen</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">calcCenter</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElecSimilarity.genPQR"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.genPQR">[docs]</a>    <span class="k">def</span> <span class="nf">genPQR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Convert all PDB files to PQR files with charges allocated according to a compatible force-field</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Generates PQR files in the pqrdir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbdir</span>
        <span class="n">pqrdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqrdir</span>
        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>
        <span class="n">path_pdb2pqr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb2pqr</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span>

        <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">:</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pdbdir</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">)</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pqrdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.pqr&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;Converting </span><span class="si">%s</span><span class="s1"> to PQR&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdbfile</span><span class="p">)</span>
            <span class="n">execPDB2PQR</span><span class="p">(</span><span class="n">path_pdb2pqr</span><span class="p">,</span> <span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="n">ff</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElecSimilarity.genDX"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.genDX">[docs]</a>    <span class="k">def</span> <span class="nf">genDX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Generates potential files using APBS.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Generates DX files in dxdir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_apbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apbs</span>
        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>
        <span class="n">pqrdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqrdir</span>
        <span class="n">dxdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxdir</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
        <span class="n">ion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ion</span>
        <span class="n">pdie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span>
        <span class="n">sdie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sdie</span>
        <span class="n">cfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glen</span>
        <span class="n">gcent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dime</span>

        <span class="n">pqrfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pqrdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.pqr&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">apbsfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dxdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pqrfile</span><span class="p">,</span> <span class="n">apbsfile</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pqrfiles</span><span class="p">,</span> <span class="n">apbsfiles</span><span class="p">):</span>
            <span class="n">calcDX</span><span class="p">(</span><span class="n">path_apbs</span><span class="p">,</span> <span class="n">pqrfile</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">apbsfile</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="n">sdie</span><span class="p">,</span> <span class="n">cfac</span><span class="o">=</span><span class="n">cfac</span><span class="p">,</span> <span class="n">glen</span><span class="o">=</span><span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="o">=</span><span class="n">gcent</span><span class="p">,</span> <span class="n">dime</span><span class="o">=</span><span class="n">dime</span><span class="p">)</span></div>

<div class="viewcode-block" id="ElecSimilarity.genDX_parallel"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.genDX_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">genDX_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Generates multiple potential files in parallel by calling APBS multiple times according to how many threads are available/specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_workers : int</span>
<span class="sd">            Number of processes to run. If None, method will use all available threads.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Generates DX files in dxdir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>
        <span class="n">pqrdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqrdir</span>
        <span class="n">dxdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxdir</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>
        <span class="n">ion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ion</span>
        <span class="n">pdie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdie</span>
        <span class="n">sdie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sdie</span>
        <span class="n">cfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfac</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glen</span>
        <span class="n">gcent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcent</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dime</span>

        <span class="k">if</span> <span class="n">n_workers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        	<span class="n">n_workers</span> <span class="o">=</span> <span class="n">cpu_count</span><span class="p">()</span>

        <span class="n">path_apbs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">apbs</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">pqrfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pqrdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.pqr&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">apbsfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dxdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">ion</span> <span class="o">=</span> <span class="p">[</span><span class="n">ion</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">pdie</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdie</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">sdie</span> <span class="o">=</span> <span class="p">[</span><span class="n">sdie</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">cfac</span> <span class="o">=</span> <span class="p">[</span><span class="n">cfac</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="p">[</span><span class="n">glen</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">gcent</span> <span class="o">=</span> <span class="p">[</span><span class="n">gcent</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="p">[</span><span class="n">dime</span>  <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_apbs</span><span class="p">,</span> <span class="n">pqrfiles</span><span class="p">,</span> <span class="n">apbsfiles</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="p">,</span> <span class="n">cfac</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">,</span> <span class="n">dime</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">n_workers</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">running batchCalcDX ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">batchCalcDX</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s1">&#39;.... </span><span class="si">%s</span><span class="s1">:</span><span class="se">\t</span><span class="s1">batch coulomb </span><span class="si">%d</span><span class="s1"> percent complete ....&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobname</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">counter</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max_count</span><span class="p">))</span></div>

<div class="viewcode-block" id="ElecSimilarity.calcESD"><a class="viewcode-back" href="../aesop.html#aesop.ElecSimilarity.calcESD">[docs]</a>    <span class="k">def</span> <span class="nf">calcESD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;AND&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">        Compare potential files and calculate the similarity distance. Smaller distances imply similarity.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            This parameter will allow for other metrics to compare grid potentials; however, for now only &#39;AND&#39; is implemented.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Stores esd matrix as class attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">symmetrize</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            a : TYPE</span>
<span class="sd">                Description</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            TYPE</span>
<span class="sd">                Description</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">diagonal</span><span class="p">())</span>

        <span class="n">pdbfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdbfiles</span>
        <span class="n">dxdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxdir</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dxfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dxdir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.dx&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pdbfile</span> <span class="ow">in</span> <span class="n">pdbfiles</span><span class="p">]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxfiles</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">gd</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">midpoints</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">midpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_dx</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_dx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_dx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_dx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">esd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)))</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">gd</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">gd</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="s1">&#39;AND&#39;</span><span class="p">:</span>
                <span class="n">numer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">esd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">numer</span><span class="p">,</span> <span class="n">denom</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">print</span> <span class="n">esd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
        <span class="n">esd</span> <span class="o">=</span> <span class="n">symmetrize</span><span class="p">(</span><span class="n">esd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">esd</span> <span class="o">=</span> <span class="n">esd</span></div></div>

<span class="c1"># ######################################################################################################################################################</span>
<span class="c1"># # Container for performing ESD analysis</span>
<span class="c1"># #   alascan     -   Alascan class with certain class functions.</span>
<span class="c1"># ######################################################################################################################################################</span>
<span class="c1"># class ESD:</span>
<span class="c1">#     &quot;&quot;&quot;Summary</span>
    
<span class="c1">#     Attributes</span>
<span class="c1">#     ----------</span>
<span class="c1">#     dim_dx : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     edges : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     esd : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     files : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     ids : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     ion : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     jobname : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     mask : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     midpoints : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     pdbfile : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     pdie : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     sdie : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, alascan):</span>
<span class="c1">#         &quot;&quot;&quot;Summary</span>
        
<span class="c1">#         Parameters</span>
<span class="c1">#         ----------</span>
<span class="c1">#         alascan : TYPE</span>
<span class="c1">#             Description</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         dx_files = alascan.getDX() # Get only files with index [0-9]+.</span>
<span class="c1">#         pattern_id = re.compile(&#39;\d+_0_(wt|seg\d+_[A-Z]\d+[A-Z])[.]dx&#39;)</span>
<span class="c1">#         pattern_file = re.compile(&#39;(.*[0-9]+_0_(wt|seg[0-9]+_[A-Z]\d+[A-Z])[.]dx)&#39;)</span>
<span class="c1">#         self.ids = [f.group(1) for dx_file in dx_files for f in [re.search(pattern_id, os.path.basename(dx_file))] if f]</span>
<span class="c1">#         self.files = [f.group(1) for dx_file in dx_files for f in [re.search(pattern_file, dx_file)] if f]</span>

<span class="c1">#         self.ion = alascan.ion</span>
<span class="c1">#         self.pdie = alascan.pdie</span>
<span class="c1">#         self.sdie = alascan.sdie</span>
<span class="c1">#         self.jobname = alascan.jobname</span>
<span class="c1">#         self.pdbfile = alascan.pdb</span>

<span class="c1">#         grid = gd.Grid(self.files[0])</span>
<span class="c1">#         self.midpoints = grid.midpoints</span>
<span class="c1">#         self.edges = grid.edges</span>
<span class="c1">#         self.dim_dx = grid.grid.shape</span>

<span class="c1">#         self.mask = np.ones((self.dim_dx[0]*self.dim_dx[1]*self.dim_dx[2])).astype(bool)</span>
<span class="c1">#         # num_files = len(self.dx_files)</span>
<span class="c1">#         # dim_coords = grid.grid.shape[0] * grid.grid.shape[1] * grid.grid.shape[2]</span>
<span class="c1">#         # self.coords = np.zeros((num_files, dim_coords)) # currently can&#39;t allocate enough memory</span>
<span class="c1">#         # for i in xrange(num_files):</span>
<span class="c1">#         #     grid = gd.Grid(self.dx_files[i])</span>
<span class="c1">#         #     self.coords[i,:] = grid.grid.reshape((1, dim_coords))</span>

<span class="c1">#     def findSurfaceGridPts(self, path_dssp):</span>
<span class="c1">#         &quot;&quot;&quot;Summary</span>
        
<span class="c1">#         Parameters</span>
<span class="c1">#         ----------</span>
<span class="c1">#         path_dssp : TYPE</span>
<span class="c1">#             Description</span>
        
<span class="c1">#         Returns</span>
<span class="c1">#         -------</span>
<span class="c1">#         TYPE</span>
<span class="c1">#             Description</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         pdbfile = self.pdbfile</span>
<span class="c1">#         pdb = pd.parsePDB(pdbfile)</span>
<span class="c1">#         xyz = pdb.getCoords()</span>
<span class="c1">#         hull = spatial.Delaunay(xyz)</span>
<span class="c1">#         # resid, rsa, exposed = calcRSA(pdbfile, path_dssp)</span>
<span class="c1">#         # xyz = xyz[exposed,:]</span>

<span class="c1">#         dim = (self.dim_dx[0]*self.dim_dx[1]*self.dim_dx[2]/3, 3)</span>
<span class="c1">#         grid = gd.Grid(self.files[0]).grid.reshape(dim)</span>
<span class="c1">#         # result = interp.LinearNDInterpolator(hull, grid)</span>
<span class="c1">#         # result = spatial.distance.cdist(xyz, grid)</span>
<span class="c1">#         # return result</span>




<span class="c1">#     def setMask(self, mask):</span>
<span class="c1">#         &quot;&quot;&quot;Summary</span>
        
<span class="c1">#         Parameters</span>
<span class="c1">#         ----------</span>
<span class="c1">#         mask : TYPE</span>
<span class="c1">#             Description</span>
        
<span class="c1">#         Returns</span>
<span class="c1">#         -------</span>
<span class="c1">#         TYPE</span>
<span class="c1">#             Description</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         if len(mask) == len(self.mask):</span>
<span class="c1">#             self.mask = mask</span>
<span class="c1">#         else:</span>
<span class="c1">#             print &#39;Error: unable to set mask, must be an array of length %d&#39; % (len(self.mask))</span>

<span class="c1">#     def calc(self, method=&#39;LD&#39;):</span>
<span class="c1">#         &quot;&quot;&quot;Summary</span>
        
<span class="c1">#         Parameters</span>
<span class="c1">#         ----------</span>
<span class="c1">#         method : str, optional</span>
<span class="c1">#             Description</span>
        
<span class="c1">#         Returns</span>
<span class="c1">#         -------</span>
<span class="c1">#         TYPE</span>
<span class="c1">#             Description</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         def symmetrize(a):</span>
<span class="c1">#             &quot;&quot;&quot;Summary</span>
            
<span class="c1">#             Parameters</span>
<span class="c1">#             ----------</span>
<span class="c1">#             a : TYPE</span>
<span class="c1">#                 Description</span>
            
<span class="c1">#             Returns</span>
<span class="c1">#             -------</span>
<span class="c1">#             TYPE</span>
<span class="c1">#                 Description</span>
<span class="c1">#             &quot;&quot;&quot;</span>
<span class="c1">#             return a + a.T - np.diag(a.diagonal())</span>

<span class="c1">#         files = self.files</span>
<span class="c1">#         ids = self.ids</span>
<span class="c1">#         dim = self.dim_dx[0]*self.dim_dx[1]*self.dim_dx[2]/3</span>
<span class="c1">#         esd = np.zeros((len(ids), len(ids)))</span>

<span class="c1">#         indices = it.combinations(range(len(ids)), 2)</span>
<span class="c1">#         for i, j in indices:</span>
<span class="c1">#             a = gd.Grid(files[i]).grid.reshape((dim, 3))</span>
<span class="c1">#             b = gd.Grid(files[j]).grid.reshape((dim, 3))</span>
<span class="c1">#             if method is &#39;LD&#39;:</span>
<span class="c1">#                 numer = np.linalg.norm(a-b, axis=1)</span>
<span class="c1">#                 denom = dim * np.max(np.hstack((np.linalg.norm(a, axis=1).reshape((dim, 1)), np.linalg.norm(b, axis=1).reshape((dim, 1)))), axis=1)</span>
<span class="c1">#                 esd[i, j] = np.divide(numer, denom).sum()</span>
<span class="c1">#                 print esd[i,j]</span>
<span class="c1">#         esd = symmetrize(esd)</span>
<span class="c1">#         self.esd = esd</span>

<span class="c1">#         # for file, i in zip(files, xrange(len(ids))):</span>
<span class="c1">#         #     a = gd.Grid(file).grid</span>
<span class="c1">#         #     a = a.reshape((dim, 3))</span>
<span class="c1">#         #     for file, j in zip(files, xrange(len(ids))):</span>
<span class="c1">#         #         b = gd.Grid(file).grid</span>
<span class="c1">#         #         b = b.reshape((dim, 3))</span>
<span class="c1">#         #</span>
<span class="c1">#         #         if method is &#39;LD&#39;:</span>
<span class="c1">#         #             numer = np.linalg.norm(a-b, axis=1)</span>
<span class="c1">#         #             denom = dim * np.max(np.hstack((np.linalg.norm(a, axis=1).reshape((dim, 1)), np.linalg.norm(b, axis=1).reshape((dim, 1)))), axis=1)</span>
<span class="c1">#         #             esd[i, j] = np.divide(numer, denom).sum()</span>
<span class="c1">#         # self.esd = esd</span>

<span class="c1">#     def calc_batch(self, method=&#39;LD&#39;): # NOT WORKING ... DON&#39;T USE!</span>
<span class="c1">#         &quot;&quot;&quot;Summary</span>
        
<span class="c1">#         Parameters</span>
<span class="c1">#         ----------</span>
<span class="c1">#         method : str, optional</span>
<span class="c1">#             Description</span>
        
<span class="c1">#         Returns</span>
<span class="c1">#         -------</span>
<span class="c1">#         TYPE</span>
<span class="c1">#             Description</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         def symmetrize(a):</span>
<span class="c1">#             &quot;&quot;&quot;Summary</span>
            
<span class="c1">#             Parameters</span>
<span class="c1">#             ----------</span>
<span class="c1">#             a : TYPE</span>
<span class="c1">#                 Description</span>
            
<span class="c1">#             Returns</span>
<span class="c1">#             -------</span>
<span class="c1">#             TYPE</span>
<span class="c1">#                 Description</span>
<span class="c1">#             &quot;&quot;&quot;</span>
<span class="c1">#             return a + a.T - np.diag(a.diagonal())</span>

<span class="c1">#         files = self.files</span>
<span class="c1">#         ids = self.ids</span>
<span class="c1">#         dim = self.dim_dx[0]*self.dim_dx[1]*self.dim_dx[2]/3</span>

<span class="c1">#         esd = np.zeros((len(ids), len(ids)))</span>
<span class="c1">#         indices = it.combinations(range(len(ids)), 2)</span>
<span class="c1">#         list_i = []</span>
<span class="c1">#         list_j = []</span>
<span class="c1">#         list_i_files = []</span>
<span class="c1">#         list_j_files = []</span>
<span class="c1">#         for i, j in indices:</span>
<span class="c1">#             list_i.append(i)</span>
<span class="c1">#             list_j.append(j)</span>
<span class="c1">#             list_i_files.append(files[i])</span>
<span class="c1">#             list_j_files.append(files[j])</span>
<span class="c1">#         kernel = zip(list_i, list_j, list_i_files, list_j_files)</span>
<span class="c1">#         print&#39;Starting batch ESD calculation ....&#39;</span>
<span class="c1">#         p = Pool()</span>
<span class="c1">#         counter = 0</span>
<span class="c1">#         max_count = len(kernel)</span>
<span class="c1">#         for result in p.imap_unordered(f_ld, kernel):</span>
<span class="c1">#             counter += 1</span>
<span class="c1">#             print &#39;.... Batch ESD %d percent complete ....&#39; % (int(counter * 100 / max_count))</span>
<span class="c1">#             i = int(result[0])</span>
<span class="c1">#             j = int(result[1])</span>
<span class="c1">#             x = result[2]</span>
<span class="c1">#             esd[i,j] = x</span>
<span class="c1">#             print &#39;%d, %d, %f&#39; %(i,j,x)</span>
<span class="c1">#         esd = symmetrize(esd)</span>
<span class="c1">#         self.esd = esd</span>

<span class="c1"># ######################################################################################################################################################</span>
<span class="c1"># # Function to run batch esd with LD method</span>
<span class="c1"># ######################################################################################################################################################</span>
<span class="c1"># def f_and(kernel):</span>
<span class="c1">#     &quot;&quot;&quot;Summary</span>
    
<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     kernel : TYPE</span>
<span class="c1">#         Description</span>
    
<span class="c1">#     Returns</span>
<span class="c1">#     -------</span>
<span class="c1">#     TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     i, j, file_i, file_j = kernel</span>
<span class="c1">#     a = gd.Grid(file_i).grid</span>
<span class="c1">#     b = gd.Grid(file_j).grid</span>
<span class="c1">#     dim = a.shape[0] * a.shape[1] * a.shape[2] / 3</span>
<span class="c1">#     a = a.reshape((dim, 3))</span>
<span class="c1">#     b = b.reshape((dim, 3))</span>
<span class="c1">#     numer = np.linalg.norm(a-b, axis=1)</span>
<span class="c1">#     denom = dim * np.max(np.hstack((np.linalg.norm(a, axis=1).reshape((dim, 1)), np.linalg.norm(b, axis=1).reshape((dim, 1)))), axis=1)</span>
<span class="c1">#     esd = np.divide(numer, denom).sum()</span>
<span class="c1">#     return np.array([i, j, esd])</span>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run commands, recording output</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="runProcess"><a class="viewcode-back" href="../aesop.html#aesop.runProcess">[docs]</a><span class="k">def</span> <span class="nf">runProcess</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Simple function intended to capture outputs from processes that write to STDOUT.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    command : list</span>
<span class="sd">        Lists of strings where each element is a part of the entire command. (Ex: [&#39;script&#39;,&#39;arg1&#39;,&#39;arg2&#39;,...])</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        return tuple where first element is output that would have been sent to STDOUT and the second element captures errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="c1"># proc = sp.Popen(command, stdout=sp.PIPE, shell=True)</span>
    <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="c1"># print &quot;program output:&quot;, out</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to mutate a single residue in a PDB structure, mutates with side-chain truncation</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="mutatePQR"><a class="viewcode-back" href="../aesop.html#aesop.mutatePQR">[docs]</a><span class="k">def</span> <span class="nf">mutatePQR</span><span class="p">(</span><span class="n">pqrfile</span><span class="p">,</span> <span class="n">mutid</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>  <span class="c1"># Only use this function with PARSE for now ...</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Mutate PQR file via side-chain truncation scheme (mutate to Alanine)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pqrfile : str</span>
<span class="sd">        Full path to PQR file</span>
<span class="sd">    mutid : str</span>
<span class="sd">        Prefix to use when writing mutated PQR. Should be a full path if destination is not in working directory.</span>
<span class="sd">    resnum : int</span>
<span class="sd">        Residue number to mutate to alanine.</span>
<span class="sd">    chain : str, optional</span>
<span class="sd">        Chain where residue that will be mutated is located.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Writes mutated PQR to file specified by the prefix mutid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePQR</span><span class="p">(</span><span class="n">pqrfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">residue</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;resnum </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resnum</span><span class="p">)))</span>
        <span class="n">preceed</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;resnum &lt; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resnum</span><span class="p">)))</span>
        <span class="n">follow</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;resnum &gt; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resnum</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">chain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">residue</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;chain </span><span class="si">%s</span><span class="s1"> and resnum </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">chain</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">resnum</span><span class="p">)))</span>
        <span class="n">preceed</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;chain </span><span class="si">%s</span><span class="s1"> and resnum &lt; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">chain</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">resnum</span><span class="p">)))</span>
        <span class="n">follow</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;chain </span><span class="si">%s</span><span class="s1"> and resnum &gt; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">chain</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">resnum</span><span class="p">)))</span>
        <span class="n">otherchains</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;not chain </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">chain</span><span class="p">)))</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;not sidechain&#39;</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">sidechain</span>
    <span class="n">cg</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name CG&#39;</span><span class="p">)</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name CB&#39;</span><span class="p">)</span>

    <span class="c1"># Set charge and radii of side chain to 0, change CG atom to HB1</span>
    <span class="n">residue</span><span class="o">.</span><span class="n">setResnames</span><span class="p">(</span><span class="s1">&#39;ALA&#39;</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">setCharges</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">setRadii</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">setRadii</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">cg</span><span class="o">.</span><span class="n">setNames</span><span class="p">(</span><span class="s1">&#39;HB1&#39;</span><span class="p">)</span>

    <span class="c1"># Shorten the HB1-CB bond</span>
    <span class="n">pos_hb1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7105</span> <span class="o">*</span> <span class="p">(</span><span class="n">cg</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span> <span class="o">-</span> <span class="n">cb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()))</span> <span class="o">+</span> <span class="n">cb</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>
    <span class="n">cg</span><span class="o">.</span><span class="n">setCoords</span><span class="p">(</span><span class="n">pos_hb1</span><span class="p">)</span>

    <span class="c1"># Compile mutated pdb</span>
    <span class="n">ala_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;H3&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;HA&#39;</span><span class="p">,</span> <span class="s1">&#39;CB&#39;</span><span class="p">,</span> <span class="s1">&#39;HB1&#39;</span><span class="p">,</span> <span class="s1">&#39;HB2&#39;</span><span class="p">,</span> <span class="s1">&#39;HB3&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;OXT&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">preceed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mutant</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">follow</span>
        <span class="k">if</span> <span class="n">follow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">mutant</span> <span class="o">=</span> <span class="n">preceed</span> <span class="o">+</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">preceed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">follow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">mutant</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">preceed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">follow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">mutant</span> <span class="o">=</span> <span class="n">preceed</span> <span class="o">+</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">follow</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">otherchains</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">preceed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">follow</span>
            <span class="k">if</span> <span class="n">follow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">preceed</span> <span class="o">+</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">preceed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">follow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">preceed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">follow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">preceed</span> <span class="o">+</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">follow</span>
        <span class="k">if</span> <span class="n">otherchains</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">preceed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">follow</span> <span class="o">+</span> <span class="n">otherchains</span>
            <span class="k">if</span> <span class="n">follow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">preceed</span> <span class="o">+</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">otherchains</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">preceed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">follow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">otherchains</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">preceed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">follow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">mutant</span> <span class="o">=</span> <span class="n">preceed</span> <span class="o">+</span> <span class="n">residue</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ala_atoms</span><span class="p">))</span> <span class="o">+</span> <span class="n">follow</span> <span class="o">+</span> <span class="n">otherchains</span>

    <span class="c1"># Write mutant pqr</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">writePQR</span><span class="p">(</span><span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span><span class="p">,</span> <span class="n">mutant</span><span class="p">)</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to mutate a single residue in a PDB structure, mutates with modeller by building internal coordinates of residue</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="mutatePDB"><a class="viewcode-back" href="../aesop.html#aesop.mutatePDB">[docs]</a><span class="k">def</span> <span class="nf">mutatePDB</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">mutid</span><span class="p">,</span> <span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">resid</span><span class="o">=</span><span class="s1">&#39;ALA&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function to generate a mutant structure given a local PDB file using MODELLER.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pdb : str</span>
<span class="sd">        Full path to pdbfile that will be modified.</span>
<span class="sd">    mutid : str</span>
<span class="sd">        Prefix for mutated structure that will be written. May be a full path without file extension if desired output path is not in working directory.</span>
<span class="sd">    resnum : int, or type that can be forced to int</span>
<span class="sd">        Integer number specifying residue number to be mutated.</span>
<span class="sd">    chain : str, optional</span>
<span class="sd">        Chain ID where specified residue number is to be mutated. This is necessary to specify if residue numbers are not unique on each chain.</span>
<span class="sd">    resid : str, optional</span>
<span class="sd">        Three letter amino acid code specifying the type of mutation. Default mutation is to alanine (&#39;ALA&#39;).</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Writes mutated structure to file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pdb is the pdb file</span>
    <span class="c1"># resnum is the residue number to be mutated</span>
    <span class="c1"># chain (optional) can specify what chain the residue to be mutated is located on</span>
    <span class="c1"># mutid is the prefix for the written mutated structure to be written</span>
    <span class="c1"># resid is the residue to mutate to</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">environ</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;$(LIB)/top_heav.lib&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">libs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;$(LIB)/par.lib&#39;</span><span class="p">)</span>

    <span class="n">aln</span> <span class="o">=</span> <span class="n">alignment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">mdl</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">pdb</span><span class="p">)</span>
    <span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">atom_files</span><span class="o">=</span><span class="n">pdb</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">chid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">num</span><span class="p">,</span> <span class="n">chid</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">selection</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">residue_range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">sel</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">residue_type</span><span class="o">=</span><span class="n">resid</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">chid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">resnum</span><span class="p">,</span> <span class="n">chain</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">num</span><span class="p">,</span> <span class="n">chid</span>
            <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">is</span> <span class="n">chid</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">selection</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">residue_range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">selection</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">residue_range</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">chid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">chid</span><span class="p">))</span>
            <span class="n">sel</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">residue_type</span><span class="o">=</span><span class="n">resid</span><span class="p">)</span>

    <span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s1">&#39;mutant&#39;</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">clear_topology</span><span class="p">()</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">generate_topology</span><span class="p">(</span><span class="n">aln</span><span class="p">[</span><span class="s1">&#39;mutant&#39;</span><span class="p">])</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">transfer_xyz</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>

    <span class="n">mdl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">initialize_xyz</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">build_method</span><span class="o">=</span><span class="s1">&#39;INTERNAL_COORDINATES&#39;</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span>  <span class="c1"># Without this section, chainids and resnums from parent won&#39;t be retained!</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">pdb</span><span class="p">)</span>
    <span class="n">aln</span> <span class="o">=</span> <span class="n">alignment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">atom_files</span><span class="o">=</span><span class="n">pdb</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
    <span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">atom_files</span><span class="o">=</span><span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s1">&#39;mutant&#39;</span><span class="p">)</span>
    <span class="n">h</span><span class="o">.</span><span class="n">res_num_from</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">aln</span><span class="p">)</span>  <span class="c1"># Restore old residue numbering and chain indexing</span>
    <span class="n">h</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">mutid</span> <span class="o">+</span> <span class="s1">&#39;.pdb&#39;</span><span class="p">)</span></div>

    <span class="c1">## Working Block</span>
    <span class="c1"># env = environ()</span>
    <span class="c1"># env.libs.topology.read(file=&#39;$(LIB)/top_heav.lib&#39;)</span>
    <span class="c1"># env.libs.parameters.read(file=&#39;$(LIB)/par.lib&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># aln = alignment(env)</span>
    <span class="c1"># mdl = model(env, file=pdb)</span>
    <span class="c1"># aln.append_model(mdl, atom_files=pdb, align_codes=&#39;parent&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># if ((chain is None) or (chain.isspace())):</span>
    <span class="c1">#     sel = selection(mdl.residue_range(int(resnum) - 1, int(resnum) - 1))</span>
    <span class="c1"># else:</span>
    <span class="c1">#     sel = selection(mdl.residue_range(str(resnum) + &#39;:&#39; + chain, str(resnum) + &#39;:&#39; + chain))</span>
    <span class="c1">#</span>
    <span class="c1"># sel.mutate(residue_type=resid)</span>
    <span class="c1">#</span>
    <span class="c1"># aln.append_model(mdl, align_codes=&#39;mutant&#39;)</span>
    <span class="c1"># mdl.clear_topology()</span>
    <span class="c1"># mdl.generate_topology(aln[&#39;mutant&#39;])</span>
    <span class="c1"># mdl.transfer_xyz(aln)</span>
    <span class="c1">#</span>
    <span class="c1"># mdl.build(initialize_xyz=False, build_method=&#39;INTERNAL_COORDINATES&#39;)</span>
    <span class="c1"># mdl.write(file=mutid + &#39;.pdb&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># h = model(env, file=mutid + &#39;.pdb&#39;)  # Without this section, chainids and resnums from parent won&#39;t be retained!</span>
    <span class="c1"># m = model(env, file=pdb)</span>
    <span class="c1"># aln = alignment(env)</span>
    <span class="c1"># aln.append_model(m, atom_files=pdb, align_codes=&#39;parent&#39;)</span>
    <span class="c1"># aln.append_model(h, atom_files=mutid + &#39;.pdb&#39;, align_codes=&#39;mutant&#39;)</span>
    <span class="c1"># h.res_num_from(m, aln)  # Restore old residue numbering and chain indexing</span>
    <span class="c1"># h.write(file=mutid + &#39;.pdb&#39;)</span>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run PDB2PQR.exe - should work on any supported OS</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="execPDB2PQR"><a class="viewcode-back" href="../aesop.html#aesop.execPDB2PQR">[docs]</a><span class="k">def</span> <span class="nf">execPDB2PQR</span><span class="p">(</span><span class="n">path_pdb2pqr_exe</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ff</span><span class="o">=</span><span class="s1">&#39;parse&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Calls the APBS executable according to:</span>
<span class="sd">    	&lt;path to pdb2pqr appropriate for OS&gt; --ff=parse --chain inputfile outputfile</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_pdb2pqr_exe : str</span>
<span class="sd">        Full path to pdb2pqr executable</span>
<span class="sd">    pdbfile : str</span>
<span class="sd">        PDB file to be converted to a PQR. Should be a full path if not in current working directory.</span>
<span class="sd">    outfile : str, optional</span>
<span class="sd">        File name for PQR file that will be generated. May be a full path if desired output is not in current working directory.</span>
<span class="sd">    ff : str, optional</span>
<span class="sd">        String instructing PDB2PQR what force field to employ. For more information visit: http://www.poissonboltzmann.org/docs/pdb2pqr-usage/</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (log, err) : tuple</span>
<span class="sd">        When PDB2PQR runs, outputs that would have been sent to STDOUT are captured. Log contains the run log and err contains errors.</span>
<span class="sd">    </span>
<span class="sd">    Deleted Parameters</span>
<span class="sd">    ------------------</span>
<span class="sd">    optargs : str, optional</span>
<span class="sd">        Description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pdbfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pqr&#39;</span>
    <span class="c1"># os.system(&#39;&quot;{0}&quot; {1} {2} {3}&#39;.format(path_pdb2pqr_exe, optargs, pdbfile, outfile))</span>
    <span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">runProcess</span><span class="p">([</span><span class="n">path_pdb2pqr_exe</span><span class="p">,</span> <span class="s1">&#39;--ff=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ff</span><span class="p">),</span> <span class="s1">&#39;--chain&#39;</span><span class="p">,</span> <span class="n">pdbfile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run APBS.exe - should work on any supported OS</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="execAPBS"><a class="viewcode-back" href="../aesop.html#aesop.execAPBS">[docs]</a><span class="k">def</span> <span class="nf">execAPBS</span><span class="p">(</span><span class="n">path_apbs_exe</span><span class="p">,</span> <span class="n">pqr_chain</span><span class="p">,</span> <span class="n">dime</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="mf">0.150</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="mf">78.54</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Calls the APBS executable after generating the APBS inputfile. Calculates solvation and reference energies.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_apbs_exe : str</span>
<span class="sd">        Full path to APBS executable, EX: &#39;C:\\APBS\\apbs.exe&#39;.</span>
<span class="sd">    pqr_chain : str</span>
<span class="sd">        PQR file name containing the segment that will undergo electrostatic calculations.</span>
<span class="sd">    dime : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    glen : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    gcent : list</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    prefix : str, optional</span>
<span class="sd">        Phrase to prepend before any file that is generated before writing.</span>
<span class="sd">    ion : float, optional</span>
<span class="sd">        Ionic strength for APBS calculation.</span>
<span class="sd">    pdie : float, optional</span>
<span class="sd">        Protein dielectric constant for APBS calculation.</span>
<span class="sd">    sdie : float, optional</span>
<span class="sd">        Solvent dielectric constant for APBS calculation.</span>
<span class="sd">    dx : bool, optional</span>
<span class="sd">        If true, potential files are written.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    file_apbs_log : str</span>
<span class="sd">        File name for the log file that APBS generates. This file contains results from performed calculations.</span>
<span class="sd">    </span>
<span class="sd">    Deleted Parameters</span>
<span class="sd">    ------------------</span>
<span class="sd">    pqr_complex : STRING</span>
<span class="sd">        PQR file name containing the complex that AESOP is analyzing, must contain pqr_chain</span>
<span class="sd">    grid : float, optional</span>
<span class="sd">        Grid spacing for the mesh grid based electrostatic calculations. Suggested value of 1 or below</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># path_apbs_exe -   full path to apbs executable (&#39;C:\\APBS\\apbs.exe&#39;)</span>
    <span class="c1"># pqr_chain     -   path to file with single chain pqr (mutant or parent)</span>
    <span class="c1"># pqr_complex   -   path to file with complex pqr, contains mutant or parent chain that is used in pqr_chain</span>
    <span class="c1"># prefix        -   string to pre-pend to output files (log file, dx file, energy file)</span>
    <span class="c1"># grid          -   grid spacing using in APBS calculation</span>
    <span class="c1"># ion           -   ionic strength for calculation</span>
    <span class="c1"># pdie          -   protein dielectric constant</span>
    <span class="c1"># sdie          -   solvent dielectric constant</span>

    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pqr_chain</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># cfac = 1.5 # hard-coded scaling factor for mesh dimension, for now</span>

    <span class="c1"># pqr = pd.parsePQR(pqr_complex)</span>
    <span class="c1"># coords = pqr.getCoords()</span>
    <span class="c1"># x = coords[:, 0]</span>
    <span class="c1"># y = coords[:, 1]</span>
    <span class="c1"># z = coords[:, 2]</span>

    <span class="c1"># # Determine mesh dimensions according to Ron&#39;s AESOP protocol in the R source file</span>
    <span class="c1"># if (dime is None) | (glen is None):</span>
    <span class="c1">#     fg = np.array((np.ceil(np.max(x) - np.min(x)), np.ceil(np.max(y) - np.min(y)), np.ceil(np.max(z) - np.min(z))))</span>
    <span class="c1">#     fg = np.ceil((fg + 5) * cfac)</span>
    <span class="c1">#     dime_list = (32 * np.linspace(1, 100, 100)) + 1  # list of possible dime values</span>
    <span class="c1">#     dime_ind = np.ceil(</span>
    <span class="c1">#         fg / (32 * grid)) - 1  # index of dime to use from list, subtract one to be consistent with python indexing!</span>
    <span class="c1">#</span>
    <span class="c1">#     glen = fg</span>
    <span class="c1">#     dime = np.array((dime_list[int(dime_ind[0])], dime_list[int(dime_ind[1])], dime_list[int(dime_ind[2])]))</span>

    <span class="c1"># Format APBS input file</span>
    <span class="n">cmd_read</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;read</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   mol pqr </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pqr_chain</span><span class="p">),</span>
                <span class="c1"># &#39;   mol pqr %s\n&#39; % (pqr_complex),</span>
                <span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">cmd_solv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;elec name solv</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   mg-manual</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   dime </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;   glen </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">glen</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">glen</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">glen</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;   gcent </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gcent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gcent</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gcent</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;   mol 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   lpbe</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   bcfl sdh</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   srfm smol</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   chgm spl2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   ion 1 </span><span class="si">%.2f</span><span class="s1"> 2.0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ion</span><span class="p">),</span>
                <span class="s1">&#39;   ion -1 </span><span class="si">%.2f</span><span class="s1"> 2.0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ion</span><span class="p">),</span>
                <span class="s1">&#39;   pdie </span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdie</span><span class="p">),</span>
                <span class="s1">&#39;   sdie </span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sdie</span><span class="p">),</span>
                <span class="s1">&#39;   sdens 10.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   srad 0.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   swin 0.3</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   temp 298.15</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   calcenergy total</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dx</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">cmd_solv</span> <span class="o">=</span> <span class="n">cmd_solv</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;   write pot dx </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">)]</span>
    <span class="n">cmd_solv</span> <span class="o">=</span> <span class="n">cmd_solv</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">cmd_ref</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;elec name ref</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   mg-manual</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   dime </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
               <span class="s1">&#39;   glen </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">glen</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">glen</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">glen</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
               <span class="s1">&#39;   gcent </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gcent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gcent</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gcent</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
               <span class="s1">&#39;   mol 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   lpbe</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   bcfl sdh</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   srfm smol</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   chgm spl2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   pdie </span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdie</span><span class="p">),</span>
               <span class="s1">&#39;   sdie </span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdie</span><span class="p">),</span>
               <span class="s1">&#39;   sdens 10.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   srad 0.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   swin 0.3</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   temp 298.15</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;   calcenergy total</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">cmd_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;print elecEnergy solv end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;print elecEnergy ref end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;quit</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">apbs_in</span> <span class="o">=</span> <span class="n">cmd_read</span> <span class="o">+</span> <span class="n">cmd_solv</span> <span class="o">+</span> <span class="n">cmd_ref</span> <span class="o">+</span> <span class="n">cmd_write</span>

    <span class="c1"># Write APBS input file</span>
    <span class="n">file_apbs_in</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.in&#39;</span>
    <span class="n">file_apbs_log</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_apbs_in</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">apbs_in</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Execute APBS</span>
    <span class="c1"># os.system(&#39;&quot;{0}&quot; {1} {2}&#39;.format(path_apbs_exe, &#39;--output-file=%s --output-format=flat&#39;%(file_apbs_log), file_apbs_in))</span>
    <span class="c1"># os.system(&#39;{0} {1}&#39;.format(path_apbs_exe, file_apbs_in))</span>
    <span class="c1"># (log, err) = runProcess([path_apbs_exe, file_apbs_in])</span>
    <span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">runProcess</span><span class="p">([</span><span class="n">path_apbs_exe</span><span class="p">,</span> <span class="s1">&#39;--output-file=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_apbs_log</span><span class="p">),</span> <span class="s1">&#39;--output-format=flat&#39;</span><span class="p">,</span> <span class="n">file_apbs_in</span><span class="p">])</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=Global net ELEC energy =)\s+[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?&#39;</span><span class="p">)</span>
    <span class="n">elec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">log</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="n">elec</span> <span class="o">=</span> <span class="n">elec</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">elec</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

    <span class="c1"># return file_apbs_log</span>
    <span class="k">return</span> <span class="n">elec</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run APBS.exe to generate a DX file only - should work on any supported OS</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="calcDX"><a class="viewcode-back" href="../aesop.html#aesop.calcDX">[docs]</a><span class="k">def</span> <span class="nf">calcDX</span><span class="p">(</span><span class="n">path_apbs_exe</span><span class="p">,</span> <span class="n">pqrfile</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="mf">0.150</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="mf">78.54</span><span class="p">,</span> <span class="n">cfac</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">glen</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">gcent</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dime</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Calls the APBS executable after generating the APBS inputfile. Generates a potential file (DX).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_apbs_exe : str</span>
<span class="sd">        Full path to APBS executable, EX: &#39;C:\\APBS\\apbs.exe&#39;.</span>
<span class="sd">    pqrfile : str</span>
<span class="sd">        The PQR file that will be used to generate a grid of electrostatic potentials. Must be a full path if file is not in current path.</span>
<span class="sd">    prefix : str, optional</span>
<span class="sd">        Phrase to prepend before any file that is generated before writing.</span>
<span class="sd">    grid : float, optional</span>
<span class="sd">        Distance spacing of grid points. If the grid dimensions are not divisible by three, resolution will be increased (smaller grid spacing) until grid dimensions are divisible by three.</span>
<span class="sd">    ion : float, optional</span>
<span class="sd">        Ionic strength for APBS calculation.</span>
<span class="sd">    pdie : float, optional</span>
<span class="sd">        Protein dielectric constant for APBS calculation.</span>
<span class="sd">    sdie : float, optional</span>
<span class="sd">        Solvent dielectric constant for APBS calculation.</span>
<span class="sd">    cfac : float, optional</span>
<span class="sd">        Scaling factor for grid dimensions. We suggest to leave this unchanged.</span>
<span class="sd">    glen : None, optional</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    gcent : TYPE, optional</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    dime : None, optional</span>
<span class="sd">        List of three integers. Parameter required for APBS. Please see description at: http://www.poissonboltzmann.org/docs/apbs-overview/</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (log, err) : tuple</span>
<span class="sd">        When APBS runs, outputs that would have been sent to STDOUT are captured. Log contains the run log and err contains errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">pqrfile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Determine mesh dimensions according to Ron&#39;s AESOP protocol in the R source file</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dime</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">glen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">pqr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">parsePQR</span><span class="p">(</span><span class="n">pqrfile</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">pqr</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">))))</span>
        <span class="n">fg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">fg</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">cfac</span><span class="p">)</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">glen</span><span class="p">,</span> <span class="n">fg</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dime_list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># list of possible dime values</span>
        <span class="n">dime_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">fg</span> <span class="o">/</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="n">grid</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># index of dime to use from list, subtract one to be consistent with python indexing!</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])]))</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">((</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iy</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">iz</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">dime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ix</span><span class="p">)],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">iy</span><span class="p">],</span> <span class="n">dime_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dime_ind</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">iz</span><span class="p">]))</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># glen = fg</span>
        <span class="c1"># dime = np.array((dime_list[int(dime_ind[0])], dime_list[int(dime_ind[1])], dime_list[int(dime_ind[2])]))</span>
        <span class="n">dime</span> <span class="o">=</span> <span class="n">dime</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="n">glen</span> <span class="c1">#.reshape((1, 3))</span>
        <span class="n">gcent</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">calcCenter</span><span class="p">(</span><span class="n">pqr</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Format APBS input file</span>
    <span class="n">cmd_read</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;read</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   mol pqr </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pqrfile</span><span class="p">),</span>
                <span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">cmd_solv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;elec name solv</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   mg-manual</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   dime </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dime</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dime</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;   glen </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">glen</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">glen</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">glen</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;   gcent </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gcent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gcent</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gcent</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;   mol 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   lpbe</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   bcfl sdh</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   srfm smol</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   chgm spl2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   ion 1 </span><span class="si">%.2f</span><span class="s1"> 2.0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ion</span><span class="p">),</span>
                <span class="s1">&#39;   ion -1 </span><span class="si">%.2f</span><span class="s1"> 2.0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ion</span><span class="p">),</span>
                <span class="s1">&#39;   pdie </span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdie</span><span class="p">),</span>
                <span class="s1">&#39;   sdie </span><span class="si">%.2f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sdie</span><span class="p">),</span>
                <span class="s1">&#39;   sdens 10.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   srad 0.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   swin 0.3</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   temp 298.15</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;   write pot dx </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">),</span>
                <span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>

    <span class="n">cmd_write</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;quit</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="n">apbs_in</span> <span class="o">=</span> <span class="n">cmd_read</span> <span class="o">+</span> <span class="n">cmd_solv</span> <span class="o">+</span> <span class="n">cmd_write</span>

    <span class="c1"># Write APBS input file</span>
    <span class="n">file_apbs_in</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.in&#39;</span>
    <span class="n">file_apbs_log</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_apbs_in</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">apbs_in</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Execute APBS</span>
    <span class="c1"># os.system(&#39;&quot;{0}&quot; {1} {2}&#39;.format(path_apbs_exe, &#39;--output-file=%s --output-format=flat&#39;%(file_apbs_log), file_apbs_in))</span>
    <span class="c1"># os.system(&#39;{0} {1}&#39;.format(path_apbs_exe, file_apbs_in))</span>
    <span class="c1"># (log, err) = runProcess([path_apbs_exe, file_apbs_in])</span>
    <span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">runProcess</span><span class="p">([</span><span class="n">path_apbs_exe</span><span class="p">,</span> <span class="s1">&#39;--output-file=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_apbs_log</span><span class="p">),</span> <span class="s1">&#39;--output-format=flat&#39;</span><span class="p">,</span> <span class="n">file_apbs_in</span><span class="p">])</span></div>
    <span class="c1"># print err</span>
    <span class="c1"># pattern = re.compile(&#39;(?&lt;=Global net ELEC energy =)\s+[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?&#39;)</span>
    <span class="c1"># elec = np.asarray([x.split() for x in re.findall(pattern, log)]).astype(np.float)</span>
    <span class="c1"># elec = elec.reshape((1, elec.size))</span>

    <span class="c1"># return file_apbs_log</span>
    <span class="c1"># return elec</span>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run multiple APBS processes at once</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="batchAPBS"><a class="viewcode-back" href="../aesop.html#aesop.batchAPBS">[docs]</a><span class="k">def</span> <span class="nf">batchAPBS</span><span class="p">(</span><span class="n">kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function required to run multiple APBS jobs simultaneously. Not intended for general use.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kernel : tuple</span>
<span class="sd">        Tuple of parameters required for APBS.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        i, j represent the index in the matrix with which the calculated energies correspond.</span>
<span class="sd">        The last two elements are the solvation and reference energies, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># path, pqr_chain, pqr_complex, prefix, grid, ion, pdie, sdie, cfac, dx, i, j = kernel</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">pqr_chain</span><span class="p">,</span> <span class="n">dime</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">kernel</span>
    <span class="c1"># print &#39;Calculating solvation and reference energies for: %s&#39; % (os.path.basename(pqr_chain).split(&#39;.&#39;)[0])</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">execAPBS</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pqr_chain</span><span class="p">,</span> <span class="n">dime</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="n">sdie</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">energies</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run multiple APBS processes at once for the purpose of generating only a DX file</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="batchCalcDX"><a class="viewcode-back" href="../aesop.html#aesop.batchCalcDX">[docs]</a><span class="k">def</span> <span class="nf">batchCalcDX</span><span class="p">(</span><span class="n">kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function required to run multiple APBS jobs simultaneously. Not intended for general use.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kernel : tuple</span>
<span class="sd">        Tuple of parameters required for APBS.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Writes files according to calcDX function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">pqrfile</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="p">,</span> <span class="n">cfac</span><span class="p">,</span> <span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="p">,</span> <span class="n">dime</span> <span class="o">=</span> <span class="n">kernel</span>
    <span class="n">calcDX</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pqrfile</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">ion</span><span class="o">=</span><span class="n">ion</span><span class="p">,</span> <span class="n">pdie</span><span class="o">=</span><span class="n">pdie</span><span class="p">,</span> <span class="n">sdie</span><span class="o">=</span><span class="n">sdie</span><span class="p">,</span>
                        <span class="n">cfac</span><span class="o">=</span><span class="n">cfac</span><span class="p">,</span> <span class="n">glen</span><span class="o">=</span><span class="n">glen</span><span class="p">,</span> <span class="n">gcent</span><span class="o">=</span><span class="n">gcent</span><span class="p">,</span> <span class="n">dime</span><span class="o">=</span><span class="n">dime</span><span class="p">)</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run multiple Coulomb processes at once</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="batchCoulomb"><a class="viewcode-back" href="../aesop.html#aesop.batchCoulomb">[docs]</a><span class="k">def</span> <span class="nf">batchCoulomb</span><span class="p">(</span><span class="n">kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function required to run multiple Coulomb jobs simultaneously. Not intended for general use.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kernel : tuple</span>
<span class="sd">        Tuple of parameters required for APBS.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        i, j represent the index in the matrix with which the calculated energies correspond.</span>
<span class="sd">        The last element is the Coulombic energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">pqr_chain</span><span class="p">,</span> <span class="n">pdie</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">kernel</span>
    <span class="c1"># print &#39;Calculating coulombic energies for: %s&#39; % (os.path.basename(pqr_chain).split(&#39;.&#39;)[0])</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">execCoulomb</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pqr_chain</span><span class="p">)</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">energies</span> <span class="o">/</span> <span class="n">pdie</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">energies</span><span class="p">])</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run coulomb.exe - should work on any supported OS</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="execCoulomb"><a class="viewcode-back" href="../aesop.html#aesop.execCoulomb">[docs]</a><span class="k">def</span> <span class="nf">execCoulomb</span><span class="p">(</span><span class="n">path_coulomb_exe</span><span class="p">,</span> <span class="n">pqr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Call Coulomb from APBS tools to calculate Coulombic energies.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path_coulomb_exe : str</span>
<span class="sd">        Full path to coulomb executable.</span>
<span class="sd">    pqr : TYPE</span>
<span class="sd">        Filename for PQR to use for Coulombic energy calculation. Must be full path if not in current path.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Coulombic energy associated with input PQR file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">runProcess</span><span class="p">([</span><span class="n">path_coulomb_exe</span><span class="p">,</span> <span class="n">pqr</span><span class="p">])</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">&#39;(?&lt;=Total energy =)\s+[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?&#39;</span><span class="p">)</span>  <span class="c1"># May need to update regex</span>
    <span class="n">coul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">log</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coul</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to run DSSP.exe - should work on any supported OS</span>
<span class="c1">######################################################################################################################################################</span>
<span class="c1"># def execDSSP(pdbfile, dssp):</span>
<span class="c1">#     &quot;&quot;&quot;Summary</span>
    
<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     pdbfile : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     dssp : TYPE</span>
<span class="c1">#         Description</span>
    
<span class="c1">#     Returns</span>
<span class="c1">#     -------</span>
<span class="c1">#     TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     (log, err) = runProcess([dssp, pdbfile])</span>
<span class="c1">#     return log</span>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to plot results of Alascan</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="plotScan"><a class="viewcode-back" href="../aesop.html#aesop.plotScan">[docs]</a><span class="k">def</span> <span class="nf">plotScan</span><span class="p">(</span><span class="n">Alascan</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function to display results from the computational alanine or directed mutagenesis scan.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Alascan : scan class</span>
<span class="sd">        Alascan or DirectedMutagenesis class after running the complete analysis.</span>
<span class="sd">    filename : None, optional</span>
<span class="sd">        If the resulting plot should be written to disk, specify a filename. Otherwise, the image will only be saved.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        Handles to generated figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-talk&#39;</span><span class="p">)</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">dpi_val</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)):</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span> <span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; ddGa relative to WT&#39;</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;kJ/mol&#39;</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]])))</span>
            <span class="k">if</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">150</span><span class="p">:</span>
                <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">:</span>
                <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">dpi_val</span> <span class="o">=</span> <span class="mi">600</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]))[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]][</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]))[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]][</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="mi">1</span><span class="p">]])[:,</span> <span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; dGsolv relative to WT&#39;</span><span class="p">)</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;kJ/mol&#39;</span><span class="p">)</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])))</span>
        <span class="k">if</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">150</span><span class="p">:</span>
            <span class="n">axarr</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="mi">1</span><span class="p">]])[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">:</span>
            <span class="n">axarr</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="mi">1</span><span class="p">]])[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dpi_val</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axarr</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="mi">1</span><span class="p">]])[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]))[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]][</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]))[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]][</span><span class="n">Alascan</span><span class="o">.</span><span class="n">dGsolv_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">axarr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi_val</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">axarr</span><span class="p">)</span></div>

<div class="viewcode-block" id="plotScan_interactive"><a class="viewcode-back" href="../aesop.html#aesop.plotScan_interactive">[docs]</a><span class="k">def</span> <span class="nf">plotScan_interactive</span><span class="p">(</span><span class="n">Alascan</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function to display results from the computational alanine or directed mutagenesis scan. Figure is more interactive that the standard matplotlib figure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Alascan : scan class</span>
<span class="sd">        Alascan or DirectedMutagenesis class after running the complete analysis.</span>
<span class="sd">    filename : None, optional</span>
<span class="sd">        If the resulting plot should be written to disk, specify a filename. Otherwise, the image will only be saved.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Saves image of figure, if desired.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subplot_titles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)):</span>
         <span class="n">subplot_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; ddGa relative to WT&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vertical_spacing</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="n">subplot_titles</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">)):</span>
        <span class="n">pos_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span><span class="n">i</span><span class="p">]]))</span>
        <span class="n">pos_y</span><span class="p">[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]][</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">neg_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span><span class="n">i</span><span class="p">]]))</span>
        <span class="n">neg_y</span><span class="p">[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]][</span><span class="n">Alascan</span><span class="o">.</span><span class="n">ddGa_rel</span><span class="p">()[</span><span class="n">Alascan</span><span class="o">.</span><span class="n">mask_by_sel</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">pos_trace</span><span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">pos_y</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Loss of binding&#39;</span><span class="p">,</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgba(0,136,55,1)&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">neg_trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">neg_y</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">Alascan</span><span class="o">.</span><span class="n">mutid</span><span class="p">[</span><span class="n">i</span><span class="p">]])[:,</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;Gain in binding&#39;</span><span class="p">,</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgba(123,50,148,1)&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">pos_trace</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">append_trace</span><span class="p">(</span><span class="n">neg_trace</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;kJ/mol&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;stack&#39;</span><span class="p">,</span> <span class="n">hovermode</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span><span class="p">)</span>
    <span class="n">plotly_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plotly_fig</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">py</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save_as</span><span class="p">(</span><span class="n">plotly_fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to plot results of ESD.calc()</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="plotESD"><a class="viewcode-back" href="../aesop.html#aesop.plotESD">[docs]</a><span class="k">def</span> <span class="nf">plotESD</span><span class="p">(</span><span class="n">esd</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function to display an electrostatic similarity heatmap from a previously run ElecSimilarity class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    esd : ndarray</span>
<span class="sd">        ESD matrix from ElecSimilarity class (ElecSimilarity.esd).</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        If the resulting plot should be written to disk, specify a filename. Otherwise, the image will only be saved.</span>
<span class="sd">    cmap : str, optional</span>
<span class="sd">        Colormap from matplotlib to use.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Writes image to disk, if desired.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-talk&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span> <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to plot ESD dendrogram</span>
<span class="c1">######################################################################################################################################################</span>
<div class="viewcode-block" id="plotDend"><a class="viewcode-back" href="../aesop.html#aesop.plotDend">[docs]</a><span class="k">def</span> <span class="nf">plotDend</span><span class="p">(</span><span class="n">esd</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function to display an electrostatic similarity dendrogram from a previously run ElecSimilarity class.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    esd : ElecSimilarity class</span>
<span class="sd">        ElecSimilarity class containing final esd matrix.</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        If the resulting plot should be written to disk, specify a filename. Otherwise, the image will only be saved.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Writes image to disk, if desired.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-talk&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="p">,</span> <span class="s1">&#39;ward&#39;</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span>
        <span class="n">Z</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">esd</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span>
        <span class="n">leaf_rotation</span><span class="o">=</span><span class="mf">90.</span><span class="p">,</span>  <span class="c1"># rotates the x axis labels</span>
        <span class="n">leaf_font_size</span><span class="o">=</span><span class="mf">8.</span><span class="p">,</span>  <span class="c1"># font size for the x axis labels</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Variants&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ESD&#39;</span><span class="p">)</span>
    <span class="c1"># ax.set_xticklabels(esd.ids, rotation=90 )</span>
    <span class="c1"># ax.set_ylim(0,1)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="plotESD_interactive"><a class="viewcode-back" href="../aesop.html#aesop.plotESD_interactive">[docs]</a><span class="k">def</span> <span class="nf">plotESD_interactive</span><span class="p">(</span><span class="n">esd</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YIGnBu&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Summary</span>
<span class="sd">    Function to display an electrostatic similarity heatmap from a previously run ElecSimilarity class. Figure is more interactive that the standard matplotlib figure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    esd : ElecSimilarity class</span>
<span class="sd">        ElecSimilarity class containing final esd matrix.</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        If the resulting plot should be written to disk, specify a filename. Otherwise, the image will only be saved.</span>
<span class="sd">    cmap : str, optional</span>
<span class="sd">        Colormap from matplotlib to use.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Writes image to disk, if desired.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">create_dendrogram</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">esd</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])):</span>
        <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y2&#39;</span>
    <span class="c1"># Create Side Dendrogram</span>
    <span class="n">dendro_side</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">create_dendrogram</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">esd</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dendro_side</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])):</span>
        <span class="n">dendro_side</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x2&#39;</span>
    <span class="c1"># Add Side Dendrogram Data to Figure</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dendro_side</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
    <span class="c1"># Create Heatmap</span>
    <span class="n">dendro_side2</span> <span class="o">=</span> <span class="n">FF</span><span class="o">.</span><span class="n">create_dendrogram</span><span class="p">(</span><span class="n">esd</span><span class="o">.</span><span class="n">esd</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dendro_side2</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])):</span>
        <span class="n">dendro_side2</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x2&#39;</span>
    <span class="n">dendro_leaves</span> <span class="o">=</span> <span class="n">dendro_side2</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="p">][</span><span class="s1">&#39;ticktext&#39;</span><span class="p">]</span>
    <span class="n">dendro_leaves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">dendro_leaves</span><span class="p">))</span>

    <span class="n">heat_data</span> <span class="o">=</span> <span class="n">esd</span><span class="o">.</span><span class="n">esd</span>
    <span class="n">heat_data</span> <span class="o">=</span> <span class="n">heat_data</span><span class="p">[</span><span class="n">dendro_leaves</span><span class="p">,:]</span>
    <span class="n">heat_data</span> <span class="o">=</span> <span class="n">heat_data</span><span class="p">[:,</span><span class="n">dendro_leaves</span><span class="p">]</span>

    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">dendro_leaves</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">dendro_leaves</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="n">heat_data</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">cmap</span>
        <span class="p">)</span>
    <span class="p">])</span>
    <span class="n">heatmap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;xaxis&#39;</span><span class="p">][</span><span class="s1">&#39;tickvals&#39;</span><span class="p">]</span>
    <span class="n">heatmap</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;xaxis&#39;</span><span class="p">][</span><span class="s1">&#39;tickvals&#39;</span><span class="p">]</span>

    <span class="c1"># Add Heatmap Data to Figure</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">heatmap</span><span class="p">))</span>

    <span class="c1"># Edit Layout</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                             <span class="s1">&#39;showlegend&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;hovermode&#39;</span><span class="p">:</span> <span class="s1">&#39;closest&#39;</span><span class="p">,</span>
                             <span class="p">})</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;margin&#39;</span><span class="p">:{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">140</span><span class="p">,</span>
                                      <span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">}})</span>

    <span class="c1"># Edit xaxis</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;xaxis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="s1">&#39;mirror&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;showgrid&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;showline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;zeroline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">})</span>
    <span class="c1"># Edit xaxis2</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;xaxis2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">15</span><span class="p">],</span>
                                       <span class="s1">&#39;mirror&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;showgrid&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;showline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;zeroline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;showticklabels&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}})</span>

    <span class="c1"># Edit yaxis</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">85</span><span class="p">],</span>
                                      <span class="s1">&#39;mirror&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;showgrid&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;showline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;zeroline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;showticklabels&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s1">&#39;side&#39;</span><span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;ticktext&#39;</span><span class="p">:</span> <span class="n">dendro_side</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="p">][</span><span class="s1">&#39;ticktext&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;tickvals&#39;</span><span class="p">:</span> <span class="n">dendro_side</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis&#39;</span><span class="p">][</span><span class="s1">&#39;tickvals&#39;</span><span class="p">],</span>
                                      <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">})</span>
    <span class="c1"># Edit yaxis2</span>
    <span class="n">figure</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;yaxis2&#39;</span><span class="p">:{</span><span class="s1">&#39;domain&#39;</span><span class="p">:[</span><span class="o">.</span><span class="mi">825</span><span class="p">,</span> <span class="o">.</span><span class="mi">975</span><span class="p">],</span>
                                       <span class="s1">&#39;mirror&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;showgrid&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;showline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;zeroline&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;showticklabels&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                       <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}})</span>

    <span class="c1"># Plot!</span>
    <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">py</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save_as</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>

<span class="c1"># ######################################################################################################################################################</span>
<span class="c1"># # Function to calculate RSA for PDB</span>
<span class="c1"># ######################################################################################################################################################</span>
<span class="c1"># def calcRSA(pdbfile, dssp):</span>
<span class="c1">#     &quot;&quot;&quot;Summary</span>
    
<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     pdbfile : TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     dssp : TYPE</span>
<span class="c1">#         Description</span>
    
<span class="c1">#     Returns</span>
<span class="c1">#     -------</span>
<span class="c1">#     TYPE</span>
<span class="c1">#         Description</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     # SA from: C. Chotia, The Nature of the Accessible and Buried Surfaces in Proteins, J. Mol. Biol., 105(1975)1-14.</span>
<span class="c1">#     SA_dict = {&#39;C&#39;: 135, &#39;D&#39;: 150, &#39;S&#39;: 115, &#39;Q&#39;: 180, &#39;K&#39;: 200,</span>
<span class="c1">#                &#39;I&#39;: 175, &#39;P&#39;: 145, &#39;T&#39;: 140, &#39;F&#39;: 210, &#39;N&#39;: 160,</span>
<span class="c1">#                &#39;G&#39;: 75, &#39;H&#39;: 195, &#39;L&#39;: 170, &#39;R&#39;: 225, &#39;W&#39;: 255,</span>
<span class="c1">#                &#39;A&#39;: 115, &#39;V&#39;: 155, &#39;E&#39;: 190, &#39;Y&#39;: 230, &#39;M&#39;: 185}</span>
<span class="c1">#     threshold = 0.2 # RSA below this value is considered completely buried</span>
<span class="c1">#     log = execDSSP(pdbfile, dssp)</span>
<span class="c1">#     ag = pd.parsePDB(pdbfile)</span>
<span class="c1">#     n_atoms = ag.numAtoms()</span>
<span class="c1">#     ACC = np.zeros(n_atoms, float)</span>
<span class="c1">#     lines = filter(None, log.split(&#39;\n&#39;))</span>
<span class="c1">#     iterator = iter(lines)</span>
<span class="c1">#     for line in iterator:</span>
<span class="c1">#         # print line</span>
<span class="c1">#         if line.startswith(&#39;  #  RESIDUE&#39;):</span>
<span class="c1">#             break</span>
<span class="c1">#     for line in iterator:</span>
<span class="c1">#         if line[13] == &#39;!&#39;:</span>
<span class="c1">#             continue</span>
<span class="c1">#         res = ag[(line[11], int(line[5:10]), line[10].strip())]</span>
<span class="c1">#         if res is None:</span>
<span class="c1">#             continue</span>
<span class="c1">#         indices = res.getIndices()</span>
<span class="c1">#         ACC[indices] = int(line[35:38])</span>
<span class="c1">#         ag.setData(&#39;dssp_acc&#39;, ACC)</span>

<span class="c1">#     resid = np.asarray([AA_dict[x] for x in ag.getResnames()])</span>
<span class="c1">#     sasa = ag._getData(&#39;dssp_acc&#39;)</span>
<span class="c1">#     rsa =[]</span>
<span class="c1">#     for res, sa in zip(resid, sasa):</span>
<span class="c1">#         rsa.append(sa / SA_dict[res])</span>
<span class="c1">#         # rsa = np.asarray([SA_dict[res] for res, sasa in zip(resid, sasa])</span>
<span class="c1">#     rsa = np.asarray(rsa)</span>
<span class="c1">#     return(resid, rsa, rsa&gt;=threshold)</span>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Function to parse APBS log file - REMOVED as it is not required!</span>
<span class="c1">######################################################################################################################################################</span>
<span class="c1"># def parseAPBS_totEnergy(path_log):</span>
<span class="c1">#     &quot;&quot;&quot;Searches for a &#39;totEnergy&#39; calculation result in the APBS log file</span>

<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     path_log : STRING</span>
<span class="c1">#         Full path to APBS log file, EX: &#39;C:\\Users\\User\\Documents\\AESOP\\apbs.log&#39;</span>

<span class="c1">#     Returns</span>
<span class="c1">#     -------</span>
<span class="c1">#     data : NDARRAY</span>
<span class="c1">#         Array that contains results of calculations in the log file, units should be kJ/mol</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     data = []</span>
<span class="c1">#     with open(path_log, &#39;r&#39;) as f:</span>
<span class="c1">#         lines = f.read()</span>
<span class="c1">#         # The following pattern extracts a scientific notation number only if preceded by totEnergy</span>
<span class="c1">#         # RegEx for scientific notation is: &quot;[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?&quot;</span>
<span class="c1">#         pattern = re.compile(&#39;(?&lt;=totEnergy)\s+[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?&#39;)</span>
<span class="c1">#         matches = re.findall(pattern, lines)</span>
<span class="c1">#         data = np.asarray([x.split() for x in matches]).astype(np.float)</span>
<span class="c1">#         data = data.reshape((1,data.size))</span>
<span class="c1">#     return data</span>

<span class="c1">######################################################################################################################################################</span>
<span class="c1"># Dictionary to convert between 3 letter and 1 letter amino acid codes</span>
<span class="c1">######################################################################################################################################################</span>
<span class="n">AA_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CYS&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;ASP&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;SER&#39;</span><span class="p">:</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;GLN&#39;</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;LYS&#39;</span><span class="p">:</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ILE&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;PRO&#39;</span><span class="p">:</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;THR&#39;</span><span class="p">:</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;PHE&#39;</span><span class="p">:</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">:</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span>
           <span class="s1">&#39;GLY&#39;</span><span class="p">:</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;HIS&#39;</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;LEU&#39;</span><span class="p">:</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">:</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;TRP&#39;</span><span class="p">:</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span>
           <span class="s1">&#39;ALA&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;VAL&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;GLU&#39;</span><span class="p">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;TYR&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;MET&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">}</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Reed Harrison, Rohith Mohan, Dimitrios Morikis.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
    </div>

    

    
  </body>
</html>